

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Program Listing for File Models.cpp &mdash; EPECSolve 2.0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/collapsible-lists/js/CollapsibleLists.compressed.js"></script>
        <script src="../_static/collapsible-lists/js/apply-collapsible-lists.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/collapsible-lists/css/tree_view.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> EPECSolve
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Quick Start</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Welcome</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../index.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#license">LICENSE</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../support_files/compiling.html">Compiling</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../support_files/compiling.html#cmake">CMake</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../support_files/command_line.html">Command-line interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../support_files/EPEC.html">EPEC Example</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../support_files/EPEC.html#u-v-player">u-v player</a></li>
<li class="toctree-l4"><a class="reference internal" href="../support_files/EPEC.html#x-y-player">x-y player</a></li>
<li class="toctree-l4"><a class="reference internal" href="../support_files/EPEC.html#nash-equilibrium">Nash Equilibrium</a></li>
<li class="toctree-l4"><a class="reference internal" href="../support_files/EPEC.html#modeling-the-problem">Modeling the problem</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../support_files/LCP.html">LCP Example</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../support_files/LCP.html#modeling-the-problem">Modeling the problem</a></li>
<li class="toctree-l4"><a class="reference internal" href="../support_files/LCP.html#solving">Solving</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../support_files/NashLCP.html">Nash LCP Example</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../support_files/NashLCP.html#modeling-the-problem">Modeling the problem</a></li>
<li class="toctree-l4"><a class="reference internal" href="../support_files/NashLCP.html#checking-the-solution">Checking the solution</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../support_files/QP_Param.html">QP_Param Example</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../support_files/QP_Param.html#modeling-the-problem">Modeling the problem</a></li>
<li class="toctree-l4"><a class="reference internal" href="../support_files/QP_Param.html#solving">Solving</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="namespace_Algorithms.html">Namespace Algorithms</a><ul>
<li class="toctree-l4"><a class="reference internal" href="namespace_Algorithms.html#classes">Classes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="namespace_Game.html">Namespace Game</a><ul>
<li class="toctree-l4"><a class="reference internal" href="namespace_Game.html#classes">Classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="namespace_Game.html#enums">Enums</a></li>
<li class="toctree-l4"><a class="reference internal" href="namespace_Game.html#functions">Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="namespace_Game.html#typedefs">Typedefs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="namespace_Models.html">Namespace Models</a><ul>
<li class="toctree-l4"><a class="reference internal" href="namespace_Models.html#classes">Classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="namespace_Models.html#enums">Enums</a></li>
<li class="toctree-l4"><a class="reference internal" href="namespace_Models.html#functions">Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="namespace_Models.html#typedefs">Typedefs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="namespace_Utils.html">Namespace Utils</a><ul>
<li class="toctree-l4"><a class="reference internal" href="namespace_Utils.html#functions">Functions</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../support_files/compiling.html">Compiling</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../support_files/compiling.html#cmake">CMake</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../support_files/command_line.html">Command-line interface</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../support_files/EPEC.html">EPEC Example</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../support_files/EPEC.html#u-v-player">u-v player</a></li>
<li class="toctree-l2"><a class="reference internal" href="../support_files/EPEC.html#x-y-player">x-y player</a></li>
<li class="toctree-l2"><a class="reference internal" href="../support_files/EPEC.html#nash-equilibrium">Nash Equilibrium</a></li>
<li class="toctree-l2"><a class="reference internal" href="../support_files/EPEC.html#modeling-the-problem">Modeling the problem</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../support_files/LCP.html">LCP Example</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../support_files/LCP.html#modeling-the-problem">Modeling the problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../support_files/LCP.html#solving">Solving</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../support_files/NashLCP.html">Nash LCP Example</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../support_files/NashLCP.html#modeling-the-problem">Modeling the problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../support_files/NashLCP.html#checking-the-solution">Checking the solution</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../support_files/QP_Param.html">QP_Param Example</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../support_files/QP_Param.html#modeling-the-problem">Modeling the problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../support_files/QP_Param.html#solving">Solving</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Quick References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="namespace_Algorithms.html">Namespace Algorithms</a><ul>
<li class="toctree-l2"><a class="reference internal" href="namespace_Algorithms.html#classes">Classes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="namespace_Game.html">Namespace Game</a><ul>
<li class="toctree-l2"><a class="reference internal" href="namespace_Game.html#classes">Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="namespace_Game.html#enums">Enums</a></li>
<li class="toctree-l2"><a class="reference internal" href="namespace_Game.html#functions">Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="namespace_Game.html#typedefs">Typedefs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="namespace_Models.html">Namespace Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="namespace_Models.html#classes">Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="namespace_Models.html#enums">Enums</a></li>
<li class="toctree-l2"><a class="reference internal" href="namespace_Models.html#functions">Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="namespace_Models.html#typedefs">Typedefs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="namespace_Utils.html">Namespace Utils</a><ul>
<li class="toctree-l2"><a class="reference internal" href="namespace_Utils.html#functions">Functions</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">EPECSolve</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Program Listing for File Models.cpp</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/api/program_listing_file_src_Models.cpp.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="program-listing-for-file-models-cpp">
<span id="program-listing-file-src-models-cpp"></span><h1>Program Listing for File Models.cpp<a class="headerlink" href="#program-listing-for-file-models-cpp" title="Permalink to this headline">¶</a></h1>
<p>↰ <a class="reference internal" href="file_src_Models.cpp.html#file-src-models-cpp"><span class="std std-ref">Return to documentation for file</span></a> (<code class="docutils literal notranslate"><span class="pre">src/Models.cpp</span></code>)</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;models.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;armadillo&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;boost/log/trivial.hpp&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;gurobi_c++.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iomanip&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;map&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;rapidjson/document.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;rapidjson/istreamwrapper.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;rapidjson/prettywriter.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp"></span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">rapidjson</span><span class="p">;</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="n">ostream</span> <span class="o">&amp;</span><span class="n">Models</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">ost</span><span class="p">,</span> <span class="k">const</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span> <span class="n">l</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">case</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="nl">label</span><span class="p">:</span>
    <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">left</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">setw</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="nl">val</span><span class="p">:</span>
    <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">right</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">setprecision</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">setw</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">fixed</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">ost</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">ostream</span> <span class="o">&amp;</span><span class="n">Models</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">ost</span><span class="p">,</span> <span class="k">const</span> <span class="n">Models</span><span class="o">::</span><span class="n">FollPar</span> <span class="n">P</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Follower Parameters: &quot;</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
  <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;********************&quot;</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
  <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">label</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Linear Costs&quot;</span>
      <span class="o">&lt;&lt;</span> <span class="s">&quot;:</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="nl">a</span> <span class="p">:</span> <span class="n">P</span><span class="p">.</span><span class="n">costs_lin</span><span class="p">)</span>
    <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="n">a</span><span class="p">;</span>
  <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span>
      <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">label</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Quadratic costs&quot;</span>
      <span class="o">&lt;&lt;</span> <span class="s">&quot;:</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="nl">a</span> <span class="p">:</span> <span class="n">P</span><span class="p">.</span><span class="n">costs_quad</span><span class="p">)</span>
    <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="n">a</span><span class="p">;</span>
  <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span>
      <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">label</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Production capacities&quot;</span>
      <span class="o">&lt;&lt;</span> <span class="s">&quot;:</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="nl">a</span> <span class="p">:</span> <span class="n">P</span><span class="p">.</span><span class="n">capacities</span><span class="p">)</span>
    <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">val</span>
        <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">a</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">std</span><span class="o">::</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;::</span><span class="n">infinity</span><span class="p">()</span> <span class="o">:</span> <span class="n">a</span><span class="p">);</span>
  <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span>
      <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">label</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Tax Caps&quot;</span>
      <span class="o">&lt;&lt;</span> <span class="s">&quot;:</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="nl">a</span> <span class="p">:</span> <span class="n">P</span><span class="p">.</span><span class="n">tax_caps</span><span class="p">)</span>
    <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">val</span>
        <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">a</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">std</span><span class="o">::</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;::</span><span class="n">infinity</span><span class="p">()</span> <span class="o">:</span> <span class="n">a</span><span class="p">);</span>
  <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">ost</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">ostream</span> <span class="o">&amp;</span><span class="n">Models</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">ost</span><span class="p">,</span> <span class="k">const</span> <span class="n">Models</span><span class="o">::</span><span class="n">DemPar</span> <span class="n">P</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Demand Parameters: &quot;</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
  <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;******************&quot;</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
  <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Price</span><span class="se">\t\t</span><span class="s"> =</span><span class="se">\t\t</span><span class="s"> &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">P</span><span class="p">.</span><span class="n">alpha</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">-</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">P</span><span class="p">.</span><span class="n">beta</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;  x   Quantity&quot;</span>
      <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">ost</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">ostream</span> <span class="o">&amp;</span><span class="n">Models</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">ost</span><span class="p">,</span> <span class="k">const</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeadPar</span> <span class="n">P</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Leader Parameters: &quot;</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
  <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;******************&quot;</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
  <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">fixed</span><span class="p">;</span>
  <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">label</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Export Limit&quot;</span>
      <span class="o">&lt;&lt;</span> <span class="s">&quot;:&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">val</span>
      <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">P</span><span class="p">.</span><span class="n">export_limit</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">std</span><span class="o">::</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;::</span><span class="n">infinity</span><span class="p">()</span>
                             <span class="o">:</span> <span class="n">P</span><span class="p">.</span><span class="n">export_limit</span><span class="p">);</span>
  <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
  <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">label</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Import Limit&quot;</span>
      <span class="o">&lt;&lt;</span> <span class="s">&quot;:&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">val</span>
      <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">P</span><span class="p">.</span><span class="n">import_limit</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">std</span><span class="o">::</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;::</span><span class="n">infinity</span><span class="p">()</span>
                             <span class="o">:</span> <span class="n">P</span><span class="p">.</span><span class="n">import_limit</span><span class="p">);</span>
  <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
  <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">label</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Price limit&quot;</span>
      <span class="o">&lt;&lt;</span> <span class="s">&quot;:&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">val</span>
      <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">P</span><span class="p">.</span><span class="n">price_limit</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">std</span><span class="o">::</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;::</span><span class="n">infinity</span><span class="p">()</span>
                            <span class="o">:</span> <span class="n">P</span><span class="p">.</span><span class="n">price_limit</span><span class="p">);</span>
  <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">ost</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">ostream</span> <span class="o">&amp;</span><span class="n">Models</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">ost</span><span class="p">,</span> <span class="k">const</span> <span class="n">Models</span><span class="o">::</span><span class="n">EPECInstance</span> <span class="n">I</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;EPEC Instance: &quot;</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
  <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;******************&quot;</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="nl">a</span> <span class="p">:</span> <span class="n">I</span><span class="p">.</span><span class="n">Countries</span><span class="p">)</span>
    <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
  <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Transportation Costs:&quot;</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span> <span class="o">&lt;&lt;</span> <span class="n">I</span><span class="p">.</span><span class="n">TransportationCosts</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">ost</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">ostream</span> <span class="o">&amp;</span><span class="n">Models</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">ost</span><span class="p">,</span> <span class="k">const</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeadAllPar</span> <span class="n">P</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">;</span>
  <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;***************************&quot;</span>
      <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
  <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Leader Complete Description&quot;</span>
      <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
  <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;***************************&quot;</span>
      <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
      <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
  <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">label</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Number of followers&quot;</span>
      <span class="o">&lt;&lt;</span> <span class="s">&quot;:&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="n">P</span><span class="p">.</span><span class="n">n_followers</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s"> &quot;</span>
      <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
  <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span>
      <span class="o">&lt;&lt;</span> <span class="n">P</span><span class="p">.</span><span class="n">LeaderParam</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span>
      <span class="o">&lt;&lt;</span> <span class="n">P</span><span class="p">.</span><span class="n">FollowerParam</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span>
      <span class="o">&lt;&lt;</span> <span class="n">P</span><span class="p">.</span><span class="n">DemandParam</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
  <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;***************************&quot;</span>
      <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
      <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">ost</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">ostream</span> <span class="o">&amp;</span><span class="n">Models</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">ost</span><span class="p">,</span> <span class="k">const</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span> <span class="n">l</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">case</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="nl">FollowerStart</span><span class="p">:</span>
    <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Models::LeaderVars::FollowerStart&quot;</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="nl">NetImport</span><span class="p">:</span>
    <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Models::LeaderVars::NetImport&quot;</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="nl">NetExport</span><span class="p">:</span>
    <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Models::LeaderVars::NetExport&quot;</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="nl">CountryImport</span><span class="p">:</span>
    <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Models::LeaderVars::CountryImport&quot;</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="nl">Caps</span><span class="p">:</span>
    <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Models::LeaderVars::Caps&quot;</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="nl">Tax</span><span class="p">:</span>
    <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Models::LeaderVars::Tax&quot;</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="nl">TaxQuad</span><span class="p">:</span>
    <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Models::LeaderVars::TaxQuad&quot;</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="nl">DualVar</span><span class="p">:</span>
    <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Models::LeaderVars::DualVar&quot;</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="nl">ConvHullDummy</span><span class="p">:</span>
    <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Models::LeaderVars::ConvHullDummy&quot;</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="nl">End</span><span class="p">:</span>
    <span class="n">ost</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Models::LeaderVars::End&quot;</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="p">};</span>
  <span class="k">return</span> <span class="n">ost</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">Models</span><span class="o">::</span><span class="n">EPEC</span><span class="o">::</span><span class="n">ParamValid</span><span class="p">(</span>
    <span class="k">const</span> <span class="n">LeadAllPar</span> <span class="o">&amp;</span><span class="n">Params</span>
<span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">Params</span><span class="p">.</span><span class="n">n_followers</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">throw</span> <span class="s">&quot;Error in EPEC::ParamValid(). 0 Followers?&quot;</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">Params</span><span class="p">.</span><span class="n">FollowerParam</span><span class="p">.</span><span class="n">costs_lin</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="n">Params</span><span class="p">.</span><span class="n">n_followers</span> <span class="o">||</span>
      <span class="n">Params</span><span class="p">.</span><span class="n">FollowerParam</span><span class="p">.</span><span class="n">costs_quad</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="n">Params</span><span class="p">.</span><span class="n">n_followers</span> <span class="o">||</span>
      <span class="n">Params</span><span class="p">.</span><span class="n">FollowerParam</span><span class="p">.</span><span class="n">capacities</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="n">Params</span><span class="p">.</span><span class="n">n_followers</span> <span class="o">||</span>
      <span class="n">Params</span><span class="p">.</span><span class="n">FollowerParam</span><span class="p">.</span><span class="n">tax_caps</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="n">Params</span><span class="p">.</span><span class="n">n_followers</span> <span class="o">||</span>
      <span class="n">Params</span><span class="p">.</span><span class="n">FollowerParam</span><span class="p">.</span><span class="n">emission_costs</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="n">Params</span><span class="p">.</span><span class="n">n_followers</span><span class="p">)</span>
    <span class="k">throw</span> <span class="s">&quot;Error in EPEC::ParamValid(). Size Mismatch&quot;</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">Params</span><span class="p">.</span><span class="n">DemandParam</span><span class="p">.</span><span class="n">alpha</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">Params</span><span class="p">.</span><span class="n">DemandParam</span><span class="p">.</span><span class="n">beta</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">throw</span> <span class="s">&quot;Error in EPEC::ParamValid(). Invalid demand curve params&quot;</span><span class="p">;</span>
  <span class="c1">// Country should have a name!</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">Params</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
    <span class="k">throw</span> <span class="s">&quot;Error in EPEC::ParamValid(). Country name empty&quot;</span><span class="p">;</span>
  <span class="c1">// Country should have a unique name</span>
  <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span> <span class="o">&amp;</span><span class="nl">p</span> <span class="p">:</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">AllLeadPars</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">Params</span><span class="p">.</span><span class="n">name</span><span class="p">.</span><span class="n">compare</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">name</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">// i.e., if the strings are same</span>
      <span class="k">throw</span> <span class="s">&quot;Error in EPEC::ParamValid(). Country name repetition&quot;</span><span class="p">;</span>
  <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Models</span><span class="o">::</span><span class="n">EPEC</span><span class="o">::</span><span class="n">make_LL_QP</span><span class="p">(</span>
    <span class="k">const</span> <span class="n">LeadAllPar</span> <span class="o">&amp;</span><span class="n">Params</span><span class="p">,</span>
    <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">follower</span><span class="p">,</span>
    <span class="n">Game</span><span class="o">::</span><span class="n">QP_Param</span>
        <span class="o">*</span><span class="n">Foll</span><span class="p">,</span>
    <span class="k">const</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeadLocs</span>
        <span class="o">&amp;</span><span class="n">Loc</span>
    <span class="p">)</span> <span class="k">noexcept</span>
<span class="p">{</span>
  <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">LeadVars</span> <span class="o">=</span>
      <span class="n">Loc</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">End</span><span class="p">)</span> <span class="o">-</span> <span class="n">Params</span><span class="p">.</span><span class="n">n_followers</span><span class="p">;</span>
  <span class="n">arma</span><span class="o">::</span><span class="n">sp_mat</span> <span class="n">Q</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">LeadVars</span> <span class="o">+</span> <span class="n">Params</span><span class="p">.</span><span class="n">n_followers</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
  <span class="c1">// Two constraints. One saying that you should be less than capacity</span>
  <span class="c1">// Another saying that you should be less than leader imposed cap!</span>
  <span class="n">arma</span><span class="o">::</span><span class="n">sp_mat</span> <span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Loc</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">End</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">B</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
  <span class="n">arma</span><span class="o">::</span><span class="n">vec</span> <span class="n">c</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">b</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="n">c</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="n">b</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="n">A</span><span class="p">.</span><span class="n">zeros</span><span class="p">();</span>
  <span class="n">B</span><span class="p">.</span><span class="n">zeros</span><span class="p">();</span>
  <span class="n">C</span><span class="p">.</span><span class="n">zeros</span><span class="p">();</span>
  <span class="n">b</span><span class="p">.</span><span class="n">zeros</span><span class="p">();</span>
  <span class="n">Q</span><span class="p">.</span><span class="n">zeros</span><span class="p">();</span>
  <span class="n">c</span><span class="p">.</span><span class="n">zeros</span><span class="p">();</span>
  <span class="c1">// Objective</span>
  <span class="n">Q</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">=</span> <span class="n">Params</span><span class="p">.</span><span class="n">FollowerParam</span><span class="p">.</span><span class="n">costs_quad</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">follower</span><span class="p">)</span> <span class="o">+</span>
            <span class="mi">2</span> <span class="o">*</span> <span class="n">Params</span><span class="p">.</span><span class="n">DemandParam</span><span class="p">.</span><span class="n">beta</span><span class="p">;</span>
  <span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">=</span> <span class="n">Params</span><span class="p">.</span><span class="n">FollowerParam</span><span class="p">.</span><span class="n">costs_lin</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">follower</span><span class="p">)</span> <span class="o">-</span> <span class="n">Params</span><span class="p">.</span><span class="n">DemandParam</span><span class="p">.</span><span class="n">alpha</span><span class="p">;</span>

  <span class="n">arma</span><span class="o">::</span><span class="n">mat</span> <span class="n">Ctemp</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Loc</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">End</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">arma</span><span class="o">::</span><span class="n">fill</span><span class="o">::</span><span class="n">zeros</span><span class="p">);</span>
  <span class="n">Ctemp</span><span class="p">.</span><span class="n">cols</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Params</span><span class="p">.</span><span class="n">n_followers</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
      <span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">Params</span><span class="p">.</span><span class="n">DemandParam</span>
                <span class="p">.</span><span class="n">beta</span><span class="p">);</span> <span class="c1">// First n-1 entries and 1 more entry is Beta</span>
  <span class="n">Ctemp</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Params</span><span class="p">.</span><span class="n">n_followers</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">Params</span><span class="p">.</span><span class="n">DemandParam</span><span class="p">.</span><span class="n">beta</span><span class="p">;</span> <span class="c1">// For q_exp</span>

  <span class="c1">// Scroll in Ctemp basing on the taxation paradigm</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">Params</span><span class="p">.</span><span class="n">LeaderParam</span><span class="p">.</span><span class="n">tax_type</span> <span class="o">==</span> <span class="n">Models</span><span class="o">::</span><span class="n">TaxType</span><span class="o">::</span><span class="n">StandardTax</span><span class="p">)</span>
    <span class="n">Ctemp</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">Params</span><span class="p">.</span><span class="n">n_followers</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">Params</span><span class="p">.</span><span class="n">n_followers</span> <span class="o">+</span> <span class="n">follower</span><span class="p">)</span> <span class="o">=</span>
        <span class="mi">1</span><span class="p">;</span> <span class="c1">// q_{-i}, then import, export, then tilde q_i, then i-th tax</span>
  <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">Params</span><span class="p">.</span><span class="n">LeaderParam</span><span class="p">.</span><span class="n">tax_type</span> <span class="o">==</span> <span class="n">Models</span><span class="o">::</span><span class="n">TaxType</span><span class="o">::</span><span class="n">SingleTax</span><span class="p">)</span>
    <span class="n">Ctemp</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">Params</span><span class="p">.</span><span class="n">n_followers</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">Params</span><span class="p">.</span><span class="n">n_followers</span> <span class="o">+</span> <span class="mi">0</span><span class="p">)</span> <span class="o">=</span>
        <span class="mi">1</span><span class="p">;</span> <span class="c1">// q_{-i}, then import, export, then tilde q_i, then only tax var</span>
  <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">Params</span><span class="p">.</span><span class="n">LeaderParam</span><span class="p">.</span><span class="n">tax_type</span> <span class="o">==</span> <span class="n">Models</span><span class="o">::</span><span class="n">TaxType</span><span class="o">::</span><span class="n">CarbonTax</span><span class="p">)</span>
    <span class="n">Ctemp</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">Params</span><span class="p">.</span><span class="n">n_followers</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">Params</span><span class="p">.</span><span class="n">n_followers</span> <span class="o">+</span> <span class="mi">0</span><span class="p">)</span> <span class="o">=</span>
        <span class="n">Params</span><span class="p">.</span><span class="n">FollowerParam</span><span class="p">.</span><span class="n">emission_costs</span><span class="p">.</span><span class="n">at</span><span class="p">(</span>
            <span class="n">follower</span><span class="p">);</span> <span class="c1">// q_{-i}, then import, export, then tilde q_i, then only</span>
                       <span class="c1">// tax var</span>

  <span class="n">C</span> <span class="o">=</span> <span class="n">Ctemp</span><span class="p">;</span>
  <span class="c1">// A(1, (Params.n_followers - 1) + 2 + follower) = 0;</span>
  <span class="c1">// Produce positive (zero) quantities and less than the cap</span>
  <span class="n">B</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">b</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">=</span> <span class="n">Params</span><span class="p">.</span><span class="n">FollowerParam</span><span class="p">.</span><span class="n">capacities</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">follower</span><span class="p">);</span>

  <span class="n">Foll</span><span class="o">-&gt;</span><span class="n">set</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">Q</span><span class="p">),</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">C</span><span class="p">),</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">A</span><span class="p">),</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">B</span><span class="p">),</span>
            <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">b</span><span class="p">));</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Models</span><span class="o">::</span><span class="n">EPEC</span><span class="o">::</span><span class="n">make_LL_LeadCons</span><span class="p">(</span>
    <span class="n">arma</span><span class="o">::</span><span class="n">sp_mat</span>
        <span class="o">&amp;</span><span class="n">LeadCons</span><span class="p">,</span>
    <span class="n">arma</span><span class="o">::</span><span class="n">vec</span> <span class="o">&amp;</span><span class="n">LeadRHS</span><span class="p">,</span>
    <span class="k">const</span> <span class="n">LeadAllPar</span> <span class="o">&amp;</span><span class="n">Params</span><span class="p">,</span>
    <span class="k">const</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeadLocs</span> <span class="o">&amp;</span><span class="n">Loc</span><span class="p">,</span>
    <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">import_lim_cons</span><span class="p">,</span>
    <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">export_lim_cons</span><span class="p">,</span>
    <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">price_lim_cons</span><span class="p">,</span>
    <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span>
        <span class="n">activeTaxCaps</span>
<span class="p">)</span> <span class="k">const</span> <span class="k">noexcept</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">activeTaxCaps</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Tax Caps are active</span>
    <span class="c1">// Different tax caps</span>
    <span class="c1">// Note that the loop is performed until this-&gt;taxVars is hit</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">follower</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">follower</span> <span class="o">&lt;</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">taxVars</span><span class="p">;</span> <span class="n">follower</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">Params</span><span class="p">.</span><span class="n">FollowerParam</span><span class="p">.</span><span class="n">tax_caps</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">follower</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Constraints for Tax limits</span>
        <span class="n">LeadCons</span><span class="p">(</span><span class="n">follower</span><span class="p">,</span> <span class="n">Loc</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">Tax</span><span class="p">)</span> <span class="o">+</span> <span class="n">follower</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">LeadRHS</span><span class="p">(</span><span class="n">follower</span><span class="p">)</span> <span class="o">=</span> <span class="n">Params</span><span class="p">.</span><span class="n">FollowerParam</span><span class="p">.</span><span class="n">tax_caps</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">follower</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="c1">// Export - import &lt;= Local Production</span>
  <span class="c1">// (28b)</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">Params</span><span class="p">.</span><span class="n">n_followers</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="n">LeadCons</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">Params</span><span class="p">.</span><span class="n">n_followers</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="n">LeadCons</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">activeTaxCaps</span><span class="p">,</span> <span class="n">Loc</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">NetExport</span><span class="p">))</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">LeadCons</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">activeTaxCaps</span><span class="p">,</span> <span class="n">Loc</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">NetImport</span><span class="p">))</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="c1">// Import limit - In more precise terms, everything that comes in minus</span>
  <span class="c1">// everything that goes out should satisfy this limit (28c)</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">import_lim_cons</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">LeadCons</span><span class="p">(</span><span class="n">activeTaxCaps</span> <span class="o">+</span> <span class="n">import_lim_cons</span><span class="p">,</span>
             <span class="n">Loc</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">NetImport</span><span class="p">))</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">LeadCons</span><span class="p">(</span><span class="n">activeTaxCaps</span> <span class="o">+</span> <span class="n">import_lim_cons</span><span class="p">,</span>
             <span class="n">Loc</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">NetExport</span><span class="p">))</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">LeadRHS</span><span class="p">(</span><span class="n">activeTaxCaps</span> <span class="o">+</span> <span class="n">import_lim_cons</span><span class="p">)</span> <span class="o">=</span> <span class="n">Params</span><span class="p">.</span><span class="n">LeaderParam</span><span class="p">.</span><span class="n">import_limit</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Export limit - In more precise terms, everything that goes out minus</span>
  <span class="c1">// everything that comes in should satisfy this limit (28d)</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">export_lim_cons</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">LeadCons</span><span class="p">(</span><span class="n">activeTaxCaps</span> <span class="o">+</span> <span class="n">import_lim_cons</span> <span class="o">+</span> <span class="n">export_lim_cons</span><span class="p">,</span>
             <span class="n">Loc</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">NetExport</span><span class="p">))</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">LeadCons</span><span class="p">(</span><span class="n">activeTaxCaps</span> <span class="o">+</span> <span class="n">import_lim_cons</span> <span class="o">+</span> <span class="n">export_lim_cons</span><span class="p">,</span>
             <span class="n">Loc</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">NetImport</span><span class="p">))</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">LeadRHS</span><span class="p">(</span><span class="n">activeTaxCaps</span> <span class="o">+</span> <span class="n">import_lim_cons</span> <span class="o">+</span> <span class="n">export_lim_cons</span><span class="p">)</span> <span class="o">=</span>
        <span class="n">Params</span><span class="p">.</span><span class="n">LeaderParam</span><span class="p">.</span><span class="n">export_limit</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// (28g)</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">price_lim_cons</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">Params</span><span class="p">.</span><span class="n">n_followers</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
      <span class="n">LeadCons</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">activeTaxCaps</span> <span class="o">+</span> <span class="n">price_lim_cons</span> <span class="o">+</span> <span class="n">import_lim_cons</span> <span class="o">+</span>
                      <span class="n">export_lim_cons</span><span class="p">,</span>
                  <span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">Params</span><span class="p">.</span><span class="n">DemandParam</span><span class="p">.</span><span class="n">beta</span><span class="p">;</span>
    <span class="n">LeadCons</span><span class="p">.</span><span class="n">at</span><span class="p">(</span>
        <span class="n">activeTaxCaps</span> <span class="o">+</span> <span class="n">price_lim_cons</span> <span class="o">+</span> <span class="n">import_lim_cons</span> <span class="o">+</span> <span class="n">export_lim_cons</span><span class="p">,</span>
        <span class="n">Loc</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">NetImport</span><span class="p">))</span> <span class="o">=</span> <span class="o">-</span><span class="n">Params</span><span class="p">.</span><span class="n">DemandParam</span><span class="p">.</span><span class="n">beta</span><span class="p">;</span>
    <span class="n">LeadCons</span><span class="p">.</span><span class="n">at</span><span class="p">(</span>
        <span class="n">activeTaxCaps</span> <span class="o">+</span> <span class="n">price_lim_cons</span> <span class="o">+</span> <span class="n">import_lim_cons</span> <span class="o">+</span> <span class="n">export_lim_cons</span><span class="p">,</span>
        <span class="n">Loc</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">NetExport</span><span class="p">))</span> <span class="o">=</span> <span class="n">Params</span><span class="p">.</span><span class="n">DemandParam</span><span class="p">.</span><span class="n">beta</span><span class="p">;</span>
    <span class="n">LeadRHS</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">activeTaxCaps</span> <span class="o">+</span> <span class="n">price_lim_cons</span> <span class="o">+</span> <span class="n">import_lim_cons</span> <span class="o">+</span>
               <span class="n">export_lim_cons</span><span class="p">)</span> <span class="o">=</span>
        <span class="n">Params</span><span class="p">.</span><span class="n">LeaderParam</span><span class="p">.</span><span class="n">price_limit</span> <span class="o">-</span> <span class="n">Params</span><span class="p">.</span><span class="n">DemandParam</span><span class="p">.</span><span class="n">alpha</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// revenue tax</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">Params</span><span class="p">.</span><span class="n">LeaderParam</span><span class="p">.</span><span class="n">tax_revenue</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// If taxation paradigm is not standard (0), then just one tax variable is</span>
    <span class="c1">// used.</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">standardTax</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">carbonTax</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">Params</span><span class="p">.</span><span class="n">LeaderParam</span><span class="p">.</span><span class="n">tax_type</span> <span class="o">!=</span> <span class="n">Models</span><span class="o">::</span><span class="n">TaxType</span><span class="o">::</span><span class="n">StandardTax</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">standardTax</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="c1">// If carbon tax, we should modify McCornick inequalities</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">Params</span><span class="p">.</span><span class="n">LeaderParam</span><span class="p">.</span><span class="n">tax_type</span> <span class="o">==</span> <span class="n">Models</span><span class="o">::</span><span class="n">TaxType</span><span class="o">::</span><span class="n">CarbonTax</span><span class="p">)</span>
        <span class="n">carbonTax</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">Params</span><span class="p">.</span><span class="n">n_followers</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="kt">double</span> <span class="n">t_cap</span> <span class="o">=</span> <span class="p">(</span><span class="n">Params</span><span class="p">.</span><span class="n">FollowerParam</span><span class="p">.</span><span class="n">tax_caps</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">standardTax</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span>
                          <span class="o">?</span> <span class="n">Params</span><span class="p">.</span><span class="n">FollowerParam</span><span class="p">.</span><span class="n">tax_caps</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">standardTax</span><span class="p">)</span>
                          <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
      <span class="kt">double</span> <span class="n">carbonCorrection</span> <span class="o">=</span>
          <span class="p">(</span><span class="n">carbonTax</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">?</span> <span class="n">Params</span><span class="p">.</span><span class="n">FollowerParam</span><span class="p">.</span><span class="n">emission_costs</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
      <span class="c1">// -u_i + \bar{q}_it_i + \bar{t}_iq_i \le \bar{t}_i \bar{q}_i</span>
      <span class="n">LeadCons</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">activeTaxCaps</span> <span class="o">+</span> <span class="n">price_lim_cons</span> <span class="o">+</span> <span class="n">import_lim_cons</span> <span class="o">+</span>
                      <span class="n">export_lim_cons</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                  <span class="n">Loc</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">TaxQuad</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
      <span class="n">LeadCons</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">activeTaxCaps</span> <span class="o">+</span> <span class="n">price_lim_cons</span> <span class="o">+</span> <span class="n">import_lim_cons</span> <span class="o">+</span>
                      <span class="n">export_lim_cons</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                  <span class="n">Loc</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">Tax</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">standardTax</span><span class="p">)</span> <span class="o">=</span>
          <span class="n">Params</span><span class="p">.</span><span class="n">FollowerParam</span><span class="p">.</span><span class="n">capacities</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">carbonCorrection</span><span class="p">;</span>
      <span class="n">LeadCons</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">activeTaxCaps</span> <span class="o">+</span> <span class="n">price_lim_cons</span> <span class="o">+</span> <span class="n">import_lim_cons</span> <span class="o">+</span>
                      <span class="n">export_lim_cons</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                  <span class="n">Loc</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">FollowerStart</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="o">=</span>
          <span class="n">t_cap</span> <span class="o">*</span> <span class="n">carbonCorrection</span><span class="p">;</span>
      <span class="n">LeadRHS</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">activeTaxCaps</span> <span class="o">+</span> <span class="n">price_lim_cons</span> <span class="o">+</span> <span class="n">import_lim_cons</span> <span class="o">+</span>
                 <span class="n">export_lim_cons</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span>
          <span class="n">t_cap</span> <span class="o">*</span> <span class="n">Params</span><span class="p">.</span><span class="n">FollowerParam</span><span class="p">.</span><span class="n">capacities</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">carbonCorrection</span><span class="p">;</span>

      <span class="c1">// -u_i + \bar{q}_it_i  \le 0</span>
      <span class="n">LeadCons</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">activeTaxCaps</span> <span class="o">+</span> <span class="n">price_lim_cons</span> <span class="o">+</span> <span class="n">import_lim_cons</span> <span class="o">+</span>
                      <span class="n">export_lim_cons</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                  <span class="n">Loc</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">TaxQuad</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
      <span class="n">LeadCons</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">activeTaxCaps</span> <span class="o">+</span> <span class="n">price_lim_cons</span> <span class="o">+</span> <span class="n">import_lim_cons</span> <span class="o">+</span>
                      <span class="n">export_lim_cons</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                  <span class="n">Loc</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">Tax</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">standardTax</span><span class="p">)</span> <span class="o">=</span>
          <span class="n">Params</span><span class="p">.</span><span class="n">FollowerParam</span><span class="p">.</span><span class="n">capacities</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">carbonCorrection</span><span class="p">;</span>
      <span class="n">LeadRHS</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">activeTaxCaps</span> <span class="o">+</span> <span class="n">price_lim_cons</span> <span class="o">+</span> <span class="n">import_lim_cons</span> <span class="o">+</span>
                 <span class="n">export_lim_cons</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

      <span class="c1">// -u_i + \bar{t}_iq_i  \le 0</span>
      <span class="n">LeadCons</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">activeTaxCaps</span> <span class="o">+</span> <span class="n">price_lim_cons</span> <span class="o">+</span> <span class="n">import_lim_cons</span> <span class="o">+</span>
                      <span class="n">export_lim_cons</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span>
                  <span class="n">Loc</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">TaxQuad</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
      <span class="n">LeadCons</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">activeTaxCaps</span> <span class="o">+</span> <span class="n">price_lim_cons</span> <span class="o">+</span> <span class="n">import_lim_cons</span> <span class="o">+</span>
                      <span class="n">export_lim_cons</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span>
                  <span class="n">Loc</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">FollowerStart</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="o">=</span>
          <span class="n">t_cap</span> <span class="o">*</span> <span class="n">carbonCorrection</span><span class="p">;</span>
      <span class="n">LeadRHS</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">activeTaxCaps</span> <span class="o">+</span> <span class="n">price_lim_cons</span> <span class="o">+</span> <span class="n">import_lim_cons</span> <span class="o">+</span>
                 <span class="n">export_lim_cons</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">BOOST_LOG_TRIVIAL</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;********** Price Limit constraint: &quot;</span>
                           <span class="o">&lt;&lt;</span> <span class="n">price_lim_cons</span><span class="p">;</span>
  <span class="n">BOOST_LOG_TRIVIAL</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;********** Import Limit constraint: &quot;</span>
                           <span class="o">&lt;&lt;</span> <span class="n">import_lim_cons</span><span class="p">;</span>
  <span class="n">BOOST_LOG_TRIVIAL</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;********** Export Limit constraint: &quot;</span>
                           <span class="o">&lt;&lt;</span> <span class="n">export_lim_cons</span><span class="p">;</span>
  <span class="n">BOOST_LOG_TRIVIAL</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;********** Tax Limit constraints: &quot;</span>
                           <span class="o">&lt;&lt;</span> <span class="n">activeTaxCaps</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n\t</span><span class="s">&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">Models</span><span class="o">::</span><span class="n">EPEC</span> <span class="o">&amp;</span><span class="n">Models</span><span class="o">::</span><span class="n">EPEC</span><span class="o">::</span><span class="n">addCountry</span><span class="p">(</span><span class="n">Models</span><span class="o">::</span><span class="n">LeadAllPar</span> <span class="n">Params</span><span class="p">,</span>
                                       <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">addnlLeadVars</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Finalized</span><span class="p">)</span>
    <span class="k">throw</span><span class="p">(</span><span class="s">&quot;Error in Models::EPEC::addCountry: EPEC object Finalized. Call &quot;</span>
          <span class="s">&quot;EPEC::unlock() to unlock this object first and then edit.&quot;</span><span class="p">);</span>

  <span class="kt">bool</span> <span class="n">noError</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">noError</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">ParamValid</span><span class="p">(</span><span class="n">Params</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Error in Models::EPEC::addCountry: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">e</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;String: Error in Models::EPEC::addCountry: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">e</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">exception</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Exception: Error in Models::EPEC::addCountry: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span>
         <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">noError</span><span class="p">)</span>
    <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>

  <span class="c1">// Basing on the taxation paradigm, allocate the right number of taxVars in</span>
  <span class="c1">// the class</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">Params</span><span class="p">.</span><span class="n">LeaderParam</span><span class="p">.</span><span class="n">tax_type</span> <span class="o">==</span> <span class="n">Models</span><span class="o">::</span><span class="n">TaxType</span><span class="o">::</span><span class="n">StandardTax</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">BOOST_LOG_TRIVIAL</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>
        <span class="o">&lt;&lt;</span> <span class="s">&quot;Country &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Params</span><span class="p">.</span><span class="n">name</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; has a standard tax paradigm.&quot;</span><span class="p">;</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">taxVars</span> <span class="o">=</span> <span class="n">Params</span><span class="p">.</span><span class="n">n_followers</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">Params</span><span class="p">.</span><span class="n">LeaderParam</span><span class="p">.</span><span class="n">tax_type</span> <span class="o">==</span> <span class="n">Models</span><span class="o">::</span><span class="n">TaxType</span><span class="o">::</span><span class="n">SingleTax</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">BOOST_LOG_TRIVIAL</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>
          <span class="o">&lt;&lt;</span> <span class="s">&quot;Country &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Params</span><span class="p">.</span><span class="n">name</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; has a single tax paradigm.&quot;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">Params</span><span class="p">.</span><span class="n">LeaderParam</span><span class="p">.</span><span class="n">tax_type</span> <span class="o">==</span> <span class="n">Models</span><span class="o">::</span><span class="n">TaxType</span><span class="o">::</span><span class="n">CarbonTax</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">BOOST_LOG_TRIVIAL</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>
          <span class="o">&lt;&lt;</span> <span class="s">&quot;Country &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Params</span><span class="p">.</span><span class="n">name</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; has a carbon tax paradigm.&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">taxVars</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">LeadVars</span> <span class="o">=</span>
      <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">Params</span><span class="p">.</span><span class="n">LeaderParam</span><span class="p">.</span><span class="n">tax_revenue</span><span class="p">)</span> <span class="o">*</span> <span class="n">Params</span><span class="p">.</span><span class="n">n_followers</span> <span class="o">+</span> <span class="n">taxVars</span> <span class="o">+</span>
      <span class="n">addnlLeadVars</span><span class="p">;</span>
  <span class="c1">// 2 for quantity imported and exported, n for imposed cap, taxVars for taxes</span>
  <span class="c1">// and n for bilinear taxes.</span>

  <span class="n">LeadLocs</span> <span class="n">Loc</span><span class="p">;</span>
  <span class="n">Models</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">Loc</span><span class="p">);</span>

  <span class="c1">// Allocate so much space for each of these types of variables</span>
  <span class="n">Models</span><span class="o">::</span><span class="n">increaseVal</span><span class="p">(</span><span class="n">Loc</span><span class="p">,</span> <span class="n">LeaderVars</span><span class="o">::</span><span class="n">FollowerStart</span><span class="p">,</span> <span class="n">Params</span><span class="p">.</span><span class="n">n_followers</span><span class="p">);</span>
  <span class="n">Models</span><span class="o">::</span><span class="n">increaseVal</span><span class="p">(</span><span class="n">Loc</span><span class="p">,</span> <span class="n">LeaderVars</span><span class="o">::</span><span class="n">NetImport</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
  <span class="n">Models</span><span class="o">::</span><span class="n">increaseVal</span><span class="p">(</span><span class="n">Loc</span><span class="p">,</span> <span class="n">LeaderVars</span><span class="o">::</span><span class="n">NetExport</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
  <span class="n">Models</span><span class="o">::</span><span class="n">increaseVal</span><span class="p">(</span><span class="n">Loc</span><span class="p">,</span> <span class="n">LeaderVars</span><span class="o">::</span><span class="n">Caps</span><span class="p">,</span> <span class="n">Params</span><span class="p">.</span><span class="n">n_followers</span><span class="p">);</span>
  <span class="n">Models</span><span class="o">::</span><span class="n">increaseVal</span><span class="p">(</span><span class="n">Loc</span><span class="p">,</span> <span class="n">LeaderVars</span><span class="o">::</span><span class="n">Tax</span><span class="p">,</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">taxVars</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">Params</span><span class="p">.</span><span class="n">LeaderParam</span><span class="p">.</span><span class="n">tax_revenue</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">BOOST_LOG_TRIVIAL</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
        <span class="o">&lt;&lt;</span> <span class="s">&quot;Country &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Params</span><span class="p">.</span><span class="n">name</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; has tax revenue in the objective.&quot;</span><span class="p">;</span>
    <span class="n">Models</span><span class="o">::</span><span class="n">increaseVal</span><span class="p">(</span><span class="n">Loc</span><span class="p">,</span> <span class="n">LeaderVars</span><span class="o">::</span><span class="n">TaxQuad</span><span class="p">,</span> <span class="n">Params</span><span class="p">.</span><span class="n">n_followers</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Leader Constraints</span>
  <span class="kt">short</span> <span class="kt">int</span> <span class="n">import_lim_cons</span><span class="p">{</span><span class="mi">0</span><span class="p">},</span> <span class="n">export_lim_cons</span><span class="p">{</span><span class="mi">0</span><span class="p">},</span> <span class="n">price_lim_cons</span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">Params</span><span class="p">.</span><span class="n">LeaderParam</span><span class="p">.</span><span class="n">import_limit</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">import_lim_cons</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">Params</span><span class="p">.</span><span class="n">LeaderParam</span><span class="p">.</span><span class="n">export_limit</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">export_lim_cons</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">Params</span><span class="p">.</span><span class="n">LeaderParam</span><span class="p">.</span><span class="n">price_limit</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">price_lim_cons</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">activeTaxCaps</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">Params</span><span class="p">.</span><span class="n">LeaderParam</span><span class="p">.</span><span class="n">tax_type</span> <span class="o">==</span> <span class="n">Models</span><span class="o">::</span><span class="n">TaxType</span><span class="o">::</span><span class="n">StandardTax</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Since we have a standard taxation paradigm, we have to consider all</span>
    <span class="c1">// different tax caps</span>
    <span class="n">activeTaxCaps</span> <span class="o">=</span> <span class="n">count_if</span><span class="p">(</span><span class="n">Params</span><span class="p">.</span><span class="n">FollowerParam</span><span class="p">.</span><span class="n">tax_caps</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span>
                             <span class="n">Params</span><span class="p">.</span><span class="n">FollowerParam</span><span class="p">.</span><span class="n">tax_caps</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span>
                             <span class="p">[](</span><span class="kt">double</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">});</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// There is no standard taxation paradigm (so we have carbon or single).</span>
    <span class="c1">// Hence we want to consider just one caps, arbitrary the first</span>
    <span class="n">activeTaxCaps</span> <span class="o">=</span> <span class="n">count_if</span><span class="p">(</span><span class="n">Params</span><span class="p">.</span><span class="n">FollowerParam</span><span class="p">.</span><span class="n">tax_caps</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span>
                             <span class="n">Params</span><span class="p">.</span><span class="n">FollowerParam</span><span class="p">.</span><span class="n">tax_caps</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span>
                             <span class="p">[](</span><span class="kt">double</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">});</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">activeTaxCaps</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">std</span><span class="o">::</span><span class="n">equal</span><span class="p">(</span><span class="n">Params</span><span class="p">.</span><span class="n">FollowerParam</span><span class="p">.</span><span class="n">tax_caps</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                      <span class="n">Params</span><span class="p">.</span><span class="n">FollowerParam</span><span class="p">.</span><span class="n">tax_caps</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span>
                      <span class="n">Params</span><span class="p">.</span><span class="n">FollowerParam</span><span class="p">.</span><span class="n">tax_caps</span><span class="p">.</span><span class="n">begin</span><span class="p">()))</span> <span class="p">{</span>
        <span class="n">BOOST_LOG_TRIVIAL</span><span class="p">(</span><span class="n">warning</span><span class="p">)</span>
            <span class="o">&lt;&lt;</span> <span class="s">&quot;Tax caps are not equal within a non-standard tax framework. &quot;</span>
               <span class="s">&quot;Using the first value as tax limit.&quot;</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">activeTaxCaps</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">arma</span><span class="o">::</span><span class="n">sp_mat</span> <span class="n">LeadCons</span><span class="p">(</span><span class="n">import_lim_cons</span> <span class="o">+</span>     <span class="c1">// Import limit constraint</span>
                            <span class="n">export_lim_cons</span> <span class="o">+</span> <span class="c1">// Export limit constraint</span>
                            <span class="n">price_lim_cons</span> <span class="o">+</span>  <span class="c1">// Price limit constraint</span>
                            <span class="n">activeTaxCaps</span> <span class="o">+</span>   <span class="c1">// Tax limit constraints</span>
                            <span class="n">Params</span><span class="p">.</span><span class="n">n_followers</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">*</span>
                                <span class="n">Params</span><span class="p">.</span><span class="n">LeaderParam</span><span class="p">.</span><span class="n">tax_revenue</span> <span class="o">+</span> <span class="c1">// revenue tax</span>
                            <span class="mi">1</span><span class="p">,</span> <span class="c1">// Export - import &lt;= Domestic production</span>
                        <span class="n">Loc</span><span class="p">[</span><span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">End</span><span class="p">]);</span>
  <span class="n">arma</span><span class="o">::</span><span class="n">vec</span> <span class="n">LeadRHS</span><span class="p">(</span>
      <span class="n">import_lim_cons</span> <span class="o">+</span> <span class="n">export_lim_cons</span> <span class="o">+</span> <span class="n">price_lim_cons</span> <span class="o">+</span> <span class="n">activeTaxCaps</span> <span class="o">+</span>
          <span class="n">Params</span><span class="p">.</span><span class="n">n_followers</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">Params</span><span class="p">.</span><span class="n">LeaderParam</span><span class="p">.</span><span class="n">tax_revenue</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
      <span class="n">arma</span><span class="o">::</span><span class="n">fill</span><span class="o">::</span><span class="n">zeros</span><span class="p">);</span>

  <span class="n">vector</span><span class="o">&lt;</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Game</span><span class="o">::</span><span class="n">QP_Param</span><span class="o">&gt;&gt;</span> <span class="n">Players</span><span class="p">{};</span>
  <span class="c1">// Create the QP_Param* for each follower</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">follower</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">follower</span> <span class="o">&lt;</span> <span class="n">Params</span><span class="p">.</span><span class="n">n_followers</span><span class="p">;</span> <span class="n">follower</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">auto</span> <span class="n">Foll</span> <span class="o">=</span> <span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Game</span><span class="o">::</span><span class="n">QP_Param</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Env</span><span class="p">);</span>
      <span class="k">this</span><span class="o">-&gt;</span><span class="n">make_LL_QP</span><span class="p">(</span><span class="n">Params</span><span class="p">,</span> <span class="n">follower</span><span class="p">,</span> <span class="n">Foll</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span> <span class="n">Loc</span><span class="p">);</span>
      <span class="n">Players</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Foll</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// Make Leader Constraints</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">make_LL_LeadCons</span><span class="p">(</span><span class="n">LeadCons</span><span class="p">,</span> <span class="n">LeadRHS</span><span class="p">,</span> <span class="n">Params</span><span class="p">,</span> <span class="n">Loc</span><span class="p">,</span> <span class="n">import_lim_cons</span><span class="p">,</span>
                           <span class="n">export_lim_cons</span><span class="p">,</span> <span class="n">price_lim_cons</span><span class="p">,</span> <span class="n">activeTaxCaps</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="n">e</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
    <span class="k">throw</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;String in Models::EPEC::addCountry : &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">e</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
    <span class="k">throw</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">GRBException</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;GRBException in Models::EPEC::addCountry : &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">e</span><span class="p">.</span><span class="n">getErrorCode</span><span class="p">()</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot;: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">e</span><span class="p">.</span><span class="n">getMessage</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
    <span class="k">throw</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">exception</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Exception in Models::EPEC::addCountry : &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
    <span class="k">throw</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Lower level Market clearing constraints - empty</span>
  <span class="n">arma</span><span class="o">::</span><span class="n">sp_mat</span> <span class="n">MC</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">LeadVars</span> <span class="o">+</span> <span class="n">Params</span><span class="p">.</span><span class="n">n_followers</span><span class="p">);</span>
  <span class="n">arma</span><span class="o">::</span><span class="n">vec</span> <span class="n">MCRHS</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">arma</span><span class="o">::</span><span class="n">fill</span><span class="o">::</span><span class="n">zeros</span><span class="p">);</span>

  <span class="c1">// Convert the country QP to a NashGame</span>
  <span class="k">auto</span> <span class="n">N</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Game</span><span class="o">::</span><span class="n">NashGame</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Env</span><span class="p">,</span> <span class="n">Players</span><span class="p">,</span> <span class="n">MC</span><span class="p">,</span> <span class="n">MCRHS</span><span class="p">,</span>
                                            <span class="n">LeadVars</span><span class="p">,</span> <span class="n">LeadCons</span><span class="p">,</span> <span class="n">LeadRHS</span><span class="p">);</span>
  <span class="k">this</span><span class="o">-&gt;</span><span class="n">name2nos</span><span class="p">[</span><span class="n">Params</span><span class="p">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">PlayersLowerLevels</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
  <span class="k">this</span><span class="o">-&gt;</span><span class="n">PlayersLowerLevels</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">N</span><span class="p">);</span>
  <span class="n">Models</span><span class="o">::</span><span class="n">increaseVal</span><span class="p">(</span>
      <span class="n">Loc</span><span class="p">,</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">DualVar</span><span class="p">,</span>
      <span class="n">N</span><span class="o">-&gt;</span><span class="n">getNumDualVars</span><span class="p">());</span> <span class="c1">// N-&gt;getNumDualVars() will sum the number of</span>
                            <span class="c1">// constraints in each lower level QP and provide</span>
                            <span class="c1">// the sum. Indeed, this is the number of dual</span>
                            <span class="c1">// variables for the lower level.</span>
  <span class="k">this</span><span class="o">-&gt;</span><span class="n">Locations</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Loc</span><span class="p">);</span>

  <span class="k">this</span><span class="o">-&gt;</span><span class="n">EPEC</span><span class="o">::</span><span class="n">LocEnds</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="o">&amp;</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Locations</span><span class="p">.</span><span class="n">back</span><span class="p">().</span><span class="n">at</span><span class="p">(</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">End</span><span class="p">));</span>
  <span class="k">this</span><span class="o">-&gt;</span><span class="n">EPEC</span><span class="o">::</span><span class="n">ConvexHullVariables</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

  <span class="k">this</span><span class="o">-&gt;</span><span class="n">LeadConses</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">N</span><span class="o">-&gt;</span><span class="n">rewriteLeadCons</span><span class="p">());</span> <span class="c1">// Not mandatory!</span>
  <span class="k">this</span><span class="o">-&gt;</span><span class="n">AllLeadPars</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Params</span><span class="p">);</span>
  <span class="k">this</span><span class="o">-&gt;</span><span class="n">Game</span><span class="o">::</span><span class="n">EPEC</span><span class="o">::</span><span class="n">numMCVariables</span><span class="o">++</span><span class="p">;</span>
  <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">Models</span><span class="o">::</span><span class="n">EPEC</span> <span class="o">&amp;</span><span class="n">Models</span><span class="o">::</span><span class="n">EPEC</span><span class="o">::</span><span class="n">addTranspCosts</span><span class="p">(</span>
    <span class="k">const</span> <span class="n">arma</span><span class="o">::</span><span class="n">sp_mat</span> <span class="o">&amp;</span><span class="n">costs</span>
    <span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Finalized</span><span class="p">)</span>
    <span class="k">throw</span><span class="p">(</span><span class="s">&quot;Error in Models::EPEC::addTranspCosts: EPEC object Finalized. Call &quot;</span>
          <span class="s">&quot;EPEC::unlock() to unlock this object first and then edit.&quot;</span><span class="p">);</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">getNumLeaders</span><span class="p">()</span> <span class="o">!=</span> <span class="n">costs</span><span class="p">.</span><span class="n">n_rows</span> <span class="o">||</span>
        <span class="k">this</span><span class="o">-&gt;</span><span class="n">getNumLeaders</span><span class="p">()</span> <span class="o">!=</span> <span class="n">costs</span><span class="p">.</span><span class="n">n_cols</span><span class="p">)</span>
      <span class="k">throw</span><span class="p">(</span><span class="s">&quot;Error in EPEC::addTranspCosts. Invalid size of Q&quot;</span><span class="p">);</span>
    <span class="k">else</span>
      <span class="k">this</span><span class="o">-&gt;</span><span class="n">TranspCosts</span> <span class="o">=</span> <span class="n">arma</span><span class="o">::</span><span class="n">sp_mat</span><span class="p">(</span><span class="n">costs</span><span class="p">);</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">TranspCosts</span><span class="p">.</span><span class="n">diag</span><span class="p">()</span>
        <span class="p">.</span><span class="n">zeros</span><span class="p">();</span> <span class="c1">// Doesn&#39;t make sense for it to have a nonzero diagonal!</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="n">e</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
    <span class="k">throw</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;String in Models::EPEC::addTranspCosts : &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">e</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
    <span class="k">throw</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">GRBException</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;GRBException in Models::EPEC::addTranspCosts : &quot;</span>
         <span class="o">&lt;&lt;</span> <span class="n">e</span><span class="p">.</span><span class="n">getErrorCode</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">e</span><span class="p">.</span><span class="n">getMessage</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
    <span class="k">throw</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">exception</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Exception in Models::EPEC::addTranspCosts : &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
    <span class="k">throw</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Models</span><span class="o">::</span><span class="n">EPEC</span><span class="o">::</span><span class="n">preFinalize</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="cm">/*</span>
<span class="cm">     * Below for loop adds space for each country&#39;s quantity imported from</span>
<span class="cm">     * variable</span>
<span class="cm">     */</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">nImportMarkets</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">getNumLeaders</span><span class="p">());</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">getNumLeaders</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
      <span class="k">this</span><span class="o">-&gt;</span><span class="n">add_Leaders_tradebalance_constraints</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="n">e</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
    <span class="k">throw</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;String in Models::EPEC::preFinalize : &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">e</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
    <span class="k">throw</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">GRBException</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;GRBException in Models::EPEC::preFinalize : &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">e</span><span class="p">.</span><span class="n">getErrorCode</span><span class="p">()</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot;: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">e</span><span class="p">.</span><span class="n">getMessage</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
    <span class="k">throw</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">exception</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Exception in Models::EPEC::preFinalize : &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
    <span class="k">throw</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Models</span><span class="o">::</span><span class="n">EPEC</span><span class="o">::</span><span class="n">add_Leaders_tradebalance_constraints</span><span class="p">(</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">PlayersLowerLevels</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
    <span class="k">throw</span><span class="p">(</span><span class="s">&quot;Error in Models::EPEC::add_Leaders_tradebalance_constraints. &quot;</span>
          <span class="s">&quot;Bad argument&quot;</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">nImp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">LeadLocs</span> <span class="o">&amp;</span><span class="n">Loc</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">Locations</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
  <span class="c1">// Counts the number of countries from which the current country imports</span>
  <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">val</span> <span class="o">=</span> <span class="n">TranspCosts</span><span class="p">.</span><span class="n">begin_col</span><span class="p">(</span><span class="n">i</span><span class="p">);</span> <span class="n">val</span> <span class="o">!=</span> <span class="n">TranspCosts</span><span class="p">.</span><span class="n">end_col</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
       <span class="o">++</span><span class="n">val</span><span class="p">)</span>
    <span class="n">nImp</span><span class="o">++</span><span class="p">;</span>
  <span class="c1">// substitutes that answer to nImportMarkets at the current position</span>
  <span class="k">this</span><span class="o">-&gt;</span><span class="n">nImportMarkets</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">nImp</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">nImp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Models</span><span class="o">::</span><span class="n">increaseVal</span><span class="p">(</span><span class="n">Loc</span><span class="p">,</span> <span class="n">LeaderVars</span><span class="o">::</span><span class="n">CountryImport</span><span class="p">,</span> <span class="n">nImp</span><span class="p">);</span>

    <span class="n">Game</span><span class="o">::</span><span class="n">NashGame</span> <span class="o">&amp;</span><span class="n">LL_Nash</span> <span class="o">=</span> <span class="o">*</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">PlayersLowerLevels</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">get</span><span class="p">();</span>

    <span class="c1">// Adding the constraint that the sum of imports from all countries equals</span>
    <span class="c1">// total imports</span>
    <span class="n">arma</span><span class="o">::</span><span class="n">vec</span> <span class="n">a</span><span class="p">(</span><span class="n">Loc</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">End</span><span class="p">)</span> <span class="o">-</span> <span class="n">LL_Nash</span><span class="p">.</span><span class="n">getNumDualVars</span><span class="p">(),</span>
                <span class="n">arma</span><span class="o">::</span><span class="n">fill</span><span class="o">::</span><span class="n">zeros</span><span class="p">);</span>
    <span class="n">a</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">Loc</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">NetImport</span><span class="p">))</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">a</span><span class="p">.</span><span class="n">subvec</span><span class="p">(</span><span class="n">Loc</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">CountryImport</span><span class="p">),</span>
             <span class="n">Loc</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">CountryImport</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">.</span><span class="n">ones</span><span class="p">();</span>

    <span class="n">LL_Nash</span><span class="p">.</span><span class="n">addDummy</span><span class="p">(</span><span class="n">nImp</span><span class="p">,</span> <span class="n">Loc</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">CountryImport</span><span class="p">));</span>
    <span class="n">LL_Nash</span><span class="p">.</span><span class="n">addLeadCons</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">).</span><span class="n">addLeadCons</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">Game</span><span class="o">::</span><span class="n">NashGame</span> <span class="o">&amp;</span><span class="n">LL_Nash</span> <span class="o">=</span> <span class="o">*</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">PlayersLowerLevels</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">get</span><span class="p">();</span>

    <span class="c1">// Set imports and exports to zero</span>
    <span class="n">arma</span><span class="o">::</span><span class="n">vec</span> <span class="n">a</span><span class="p">(</span><span class="n">Loc</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">End</span><span class="p">)</span> <span class="o">-</span> <span class="n">LL_Nash</span><span class="p">.</span><span class="n">getNumDualVars</span><span class="p">(),</span>
                <span class="n">arma</span><span class="o">::</span><span class="n">fill</span><span class="o">::</span><span class="n">zeros</span><span class="p">);</span>
    <span class="n">a</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">Loc</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">NetImport</span><span class="p">))</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">LL_Nash</span><span class="p">.</span><span class="n">addLeadCons</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="c1">// Export &lt;= 0</span>
    <span class="n">a</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">Loc</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">NetImport</span><span class="p">))</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">a</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">Loc</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">NetExport</span><span class="p">))</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">LL_Nash</span><span class="p">.</span><span class="n">addLeadCons</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="c1">// Import &lt;= 0</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Models</span><span class="o">::</span><span class="n">EPEC</span><span class="o">::</span><span class="n">makeMCConstraints</span><span class="p">(</span><span class="n">arma</span><span class="o">::</span><span class="n">sp_mat</span> <span class="o">&amp;</span><span class="n">MCLHS</span><span class="p">,</span>
                                     <span class="n">arma</span><span class="o">::</span><span class="n">vec</span> <span class="o">&amp;</span><span class="n">MCRHS</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Finalized</span><span class="p">)</span>
    <span class="k">throw</span><span class="p">(</span><span class="s">&quot;Error in Models::EPEC::makeMCConstraints: This function can be &quot;</span>
          <span class="s">&quot;run only AFTER calling finalize()&quot;</span><span class="p">);</span>
  <span class="c1">// Transportation matrix</span>
  <span class="k">const</span> <span class="n">arma</span><span class="o">::</span><span class="n">sp_mat</span> <span class="o">&amp;</span><span class="n">TrCo</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">TranspCosts</span><span class="p">;</span>
  <span class="c1">// Output matrices</span>
  <span class="n">MCRHS</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">getNumLeaders</span><span class="p">());</span>
  <span class="n">MCLHS</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">getNumLeaders</span><span class="p">(),</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">getNumVar</span><span class="p">());</span>
  <span class="c1">// The MC constraint for each leader country</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">getNumLeaders</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">getNumLeaders</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">MCLHS</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">getPosition</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">LeaderVars</span><span class="o">::</span><span class="n">NetExport</span><span class="p">))</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">val</span> <span class="o">=</span> <span class="n">TrCo</span><span class="p">.</span><span class="n">begin_row</span><span class="p">(</span><span class="n">i</span><span class="p">);</span> <span class="n">val</span> <span class="o">!=</span> <span class="n">TrCo</span><span class="p">.</span><span class="n">end_row</span><span class="p">(</span><span class="n">i</span><span class="p">);</span> <span class="o">++</span><span class="n">val</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span>
            <span class="n">val</span><span class="p">.</span><span class="n">col</span><span class="p">();</span> <span class="c1">// This is the country which is importing from &quot;i&quot;</span>
        <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">count</span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>

        <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">val2</span> <span class="o">=</span> <span class="n">TrCo</span><span class="p">.</span><span class="n">begin_col</span><span class="p">(</span><span class="n">j</span><span class="p">);</span> <span class="n">val2</span> <span class="o">!=</span> <span class="n">TrCo</span><span class="p">.</span><span class="n">end_col</span><span class="p">(</span><span class="n">j</span><span class="p">);</span> <span class="o">++</span><span class="n">val2</span><span class="p">)</span>
        <span class="c1">// What position in the list of j&#39;s importing from countries  does i</span>
        <span class="c1">// fall in?</span>
        <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">val2</span><span class="p">.</span><span class="n">row</span><span class="p">()</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">else</span>
            <span class="n">count</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">MCLHS</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">getPosition</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">CountryImport</span><span class="p">)</span> <span class="o">+</span>
                     <span class="n">count</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Models</span><span class="o">::</span><span class="n">EPEC</span><span class="o">::</span><span class="n">make_MC_leader</span><span class="p">(</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">getNumLeaders</span><span class="p">())</span>
    <span class="k">throw</span><span class="p">(</span><span class="s">&quot;Error in Models::EPEC::add_Leaders_tradebalance_constraints. &quot;</span>
          <span class="s">&quot;Bad argument&quot;</span><span class="p">);</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="k">const</span> <span class="n">arma</span><span class="o">::</span><span class="n">sp_mat</span> <span class="o">&amp;</span><span class="n">TrCo</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">TranspCosts</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">nEPECvars</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">getNumVar</span><span class="p">();</span>
    <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">nThisMCvars</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">arma</span><span class="o">::</span><span class="n">sp_mat</span> <span class="n">C</span><span class="p">(</span><span class="n">nThisMCvars</span><span class="p">,</span> <span class="n">nEPECvars</span> <span class="o">-</span> <span class="n">nThisMCvars</span><span class="p">);</span>

    <span class="n">C</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">getPosition</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">NetExport</span><span class="p">))</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">val</span> <span class="o">=</span> <span class="n">TrCo</span><span class="p">.</span><span class="n">begin_row</span><span class="p">(</span><span class="n">i</span><span class="p">);</span> <span class="n">val</span> <span class="o">!=</span> <span class="n">TrCo</span><span class="p">.</span><span class="n">end_row</span><span class="p">(</span><span class="n">i</span><span class="p">);</span> <span class="o">++</span><span class="n">val</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">val</span><span class="p">.</span><span class="n">col</span><span class="p">();</span> <span class="c1">// This is the country which the</span>
                                        <span class="c1">// country &quot;i&quot; is importing from</span>
      <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">count</span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>

      <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">val2</span> <span class="o">=</span> <span class="n">TrCo</span><span class="p">.</span><span class="n">begin_col</span><span class="p">(</span><span class="n">j</span><span class="p">);</span> <span class="n">val2</span> <span class="o">!=</span> <span class="n">TrCo</span><span class="p">.</span><span class="n">end_col</span><span class="p">(</span><span class="n">j</span><span class="p">);</span> <span class="o">++</span><span class="n">val2</span><span class="p">)</span>
      <span class="c1">// What position in the list of j&#39;s impoting from countries  does i fall</span>
      <span class="c1">// in?</span>
      <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">val2</span><span class="p">.</span><span class="n">row</span><span class="p">()</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">else</span>
          <span class="n">count</span><span class="o">++</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="n">C</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">getPosition</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">CountryImport</span><span class="p">)</span> <span class="o">+</span> <span class="n">count</span> <span class="o">-</span>
                  <span class="p">(</span><span class="n">j</span> <span class="o">&gt;=</span> <span class="n">i</span> <span class="o">?</span> <span class="nl">nThisMCvars</span> <span class="p">:</span> <span class="mi">0</span><span class="p">))</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">this</span><span class="o">-&gt;</span><span class="n">MC_QP</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Game</span><span class="o">::</span><span class="n">QP_Param</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Env</span><span class="p">);</span>
    <span class="c1">// Note Q = {{0}}, c={0}, the MC problem has no constraints. So A=B={{}},</span>
    <span class="c1">// b={}.</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">MC_QP</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">get</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">set</span><span class="p">(</span><span class="n">arma</span><span class="o">::</span><span class="n">sp_mat</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span>                       <span class="c1">// Q</span>
                                 <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">C</span><span class="p">),</span>                             <span class="c1">// C</span>
                                 <span class="n">arma</span><span class="o">::</span><span class="n">sp_mat</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="n">nEPECvars</span> <span class="o">-</span> <span class="n">nThisMCvars</span><span class="p">},</span> <span class="c1">// A</span>
                                 <span class="n">arma</span><span class="o">::</span><span class="n">sp_mat</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="n">nThisMCvars</span><span class="p">},</span>             <span class="c1">// B</span>
                                 <span class="n">arma</span><span class="o">::</span><span class="n">vec</span><span class="p">{</span><span class="mi">0</span><span class="p">},</span>                             <span class="c1">// c</span>
                                 <span class="n">arma</span><span class="o">::</span><span class="n">vec</span><span class="p">{}</span>                               <span class="c1">// b</span>
    <span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="n">e</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
    <span class="k">throw</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;String in Models::EPEC::make_MC_leader : &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">e</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
    <span class="k">throw</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">GRBException</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;GRBException in Models::EPEC::make_MC_leader : &quot;</span>
         <span class="o">&lt;&lt;</span> <span class="n">e</span><span class="p">.</span><span class="n">getErrorCode</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">e</span><span class="p">.</span><span class="n">getMessage</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
    <span class="k">throw</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">exception</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Exception in Models::EPEC::make_MC_leader : &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
    <span class="k">throw</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">Models</span><span class="o">::</span><span class="n">EPEC</span><span class="o">::</span><span class="n">dataCheck</span><span class="p">(</span>
    <span class="k">const</span> <span class="kt">bool</span>
        <span class="n">chkAllLeadPars</span><span class="p">,</span>
    <span class="k">const</span> <span class="kt">bool</span>
        <span class="n">chkcountries_LL</span><span class="p">,</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">chkMC_QP</span><span class="p">,</span>
    <span class="k">const</span> <span class="kt">bool</span>
        <span class="n">chkLeadConses</span><span class="p">,</span>
    <span class="k">const</span> <span class="kt">bool</span>
        <span class="n">chkLeadRHSes</span><span class="p">,</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">chknImportMarkets</span><span class="p">,</span>
    <span class="k">const</span> <span class="kt">bool</span>
        <span class="n">chkLocations</span><span class="p">,</span>
    <span class="k">const</span> <span class="kt">bool</span>
        <span class="n">chkLeaderLocations</span><span class="p">,</span>
    <span class="k">const</span> <span class="kt">bool</span>
        <span class="n">chkLeadObjec</span>
<span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">chkAllLeadPars</span> <span class="o">&amp;&amp;</span> <span class="n">AllLeadPars</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">getNumLeaders</span><span class="p">())</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">chkcountries_LL</span> <span class="o">&amp;&amp;</span> <span class="n">PlayersLowerLevels</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">getNumLeaders</span><span class="p">())</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">chkMC_QP</span> <span class="o">&amp;&amp;</span> <span class="n">MC_QP</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">getNumLeaders</span><span class="p">())</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">chkLeadConses</span> <span class="o">&amp;&amp;</span> <span class="n">LeadConses</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">getNumLeaders</span><span class="p">())</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">chkLeadRHSes</span> <span class="o">&amp;&amp;</span> <span class="n">LeadRHSes</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">getNumLeaders</span><span class="p">())</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">chknImportMarkets</span> <span class="o">&amp;&amp;</span> <span class="n">nImportMarkets</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">getNumLeaders</span><span class="p">())</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">chkLocations</span> <span class="o">&amp;&amp;</span> <span class="n">Locations</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">getNumLeaders</span><span class="p">())</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">chkLeaderLocations</span> <span class="o">&amp;&amp;</span> <span class="n">LeaderLocations</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">getNumLeaders</span><span class="p">())</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">chkLeaderLocations</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">getNumVar</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">chkLeadObjec</span> <span class="o">&amp;&amp;</span> <span class="n">LeaderObjective</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">getNumLeaders</span><span class="p">())</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
  <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">Models</span><span class="o">::</span><span class="n">EPEC</span><span class="o">::</span><span class="n">getPosition</span><span class="p">(</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">countryCount</span><span class="p">,</span>
                                       <span class="k">const</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span> <span class="n">var</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">countryCount</span> <span class="o">&gt;=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">getNumLeaders</span><span class="p">())</span>
    <span class="k">throw</span><span class="p">(</span><span class="s">&quot;Error in Models::EPEC::getPosition: Bad Country Count&quot;</span><span class="p">);</span>
  <span class="k">return</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">LeaderLocations</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">countryCount</span><span class="p">)</span> <span class="o">+</span>
         <span class="k">this</span><span class="o">-&gt;</span><span class="n">Locations</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">countryCount</span><span class="p">).</span><span class="n">at</span><span class="p">(</span><span class="n">var</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">Models</span><span class="o">::</span><span class="n">EPEC</span><span class="o">::</span><span class="n">getPosition</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">countryName</span><span class="p">,</span>
                                       <span class="k">const</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span> <span class="n">var</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">getPosition</span><span class="p">(</span><span class="n">name2nos</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">countryName</span><span class="p">),</span> <span class="n">var</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">Game</span><span class="o">::</span><span class="n">NashGame</span> <span class="o">*</span><span class="n">Models</span><span class="o">::</span><span class="n">EPEC</span><span class="o">::</span><span class="n">get_LowerLevelNash</span><span class="p">(</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">PlayersLowerLevels</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">Models</span><span class="o">::</span><span class="n">EPEC</span> <span class="o">&amp;</span><span class="n">Models</span><span class="o">::</span><span class="n">EPEC</span><span class="o">::</span><span class="n">unlock</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">this</span><span class="o">-&gt;</span><span class="n">Finalized</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
  <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Models</span><span class="o">::</span><span class="n">EPEC</span><span class="o">::</span><span class="n">makeObjectivePlayer</span><span class="p">(</span>
    <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span>
        <span class="n">i</span><span class="p">,</span>
    <span class="n">Game</span><span class="o">::</span><span class="n">QP_Objective</span>
        <span class="o">&amp;</span><span class="n">QP_obj</span>
    <span class="p">)</span>
<span class="p">{</span>
  <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">nEPECvars</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">getNumVar</span><span class="p">();</span>
  <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">nThisCountryvars</span> <span class="o">=</span>
      <span class="k">this</span><span class="o">-&gt;</span><span class="n">Locations</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">at</span><span class="p">(</span><span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">End</span><span class="p">);</span>
  <span class="k">const</span> <span class="n">LeadAllPar</span> <span class="o">&amp;</span><span class="n">Params</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">AllLeadPars</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
  <span class="k">const</span> <span class="n">arma</span><span class="o">::</span><span class="n">sp_mat</span> <span class="o">&amp;</span><span class="n">TrCo</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">TranspCosts</span><span class="p">;</span>
  <span class="k">const</span> <span class="n">LeadLocs</span> <span class="o">&amp;</span><span class="n">Loc</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">Locations</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>

  <span class="n">QP_obj</span><span class="p">.</span><span class="n">Q</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nThisCountryvars</span><span class="p">,</span> <span class="n">nThisCountryvars</span><span class="p">);</span>
  <span class="n">QP_obj</span><span class="p">.</span><span class="n">c</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nThisCountryvars</span><span class="p">);</span>
  <span class="n">QP_obj</span><span class="p">.</span><span class="n">C</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nThisCountryvars</span><span class="p">,</span> <span class="n">nEPECvars</span> <span class="o">-</span> <span class="n">nThisCountryvars</span><span class="p">);</span>
  <span class="c1">// emission term</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">Loc</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">FollowerStart</span><span class="p">),</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
       <span class="n">count</span> <span class="o">&lt;</span> <span class="n">Params</span><span class="p">.</span><span class="n">n_followers</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">,</span> <span class="n">count</span><span class="o">++</span><span class="p">)</span>
    <span class="n">QP_obj</span><span class="p">.</span><span class="n">c</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">Params</span><span class="p">.</span><span class="n">FollowerParam</span><span class="p">.</span><span class="n">emission_costs</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">count</span><span class="p">);</span>

  <span class="c1">// revenue tax</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">Params</span><span class="p">.</span><span class="n">LeaderParam</span><span class="p">.</span><span class="n">tax_revenue</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">Loc</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">TaxQuad</span><span class="p">),</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
         <span class="n">count</span> <span class="o">&lt;</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">taxVars</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">,</span> <span class="n">count</span><span class="o">++</span><span class="p">)</span>
      <span class="n">QP_obj</span><span class="p">.</span><span class="n">c</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">getNumLeaders</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// export revenue term</span>

    <span class="n">QP_obj</span><span class="p">.</span><span class="n">C</span><span class="p">(</span>
        <span class="n">Loc</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">NetExport</span><span class="p">),</span>
        <span class="c1">// this-&gt;getPosition(i, Models::LeaderVars::End) -</span>
        <span class="c1">// nThisCountryvars) = -1;</span>
        <span class="k">this</span><span class="o">-&gt;</span><span class="n">getPosition</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">getNumLeaders</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">End</span><span class="p">)</span> <span class="o">-</span>
            <span class="n">nThisCountryvars</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

    <span class="c1">// Import cost term.</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">count</span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">val</span> <span class="o">=</span> <span class="n">TrCo</span><span class="p">.</span><span class="n">begin_col</span><span class="p">(</span><span class="n">i</span><span class="p">);</span> <span class="n">val</span> <span class="o">!=</span> <span class="n">TrCo</span><span class="p">.</span><span class="n">end_col</span><span class="p">(</span><span class="n">i</span><span class="p">);</span> <span class="o">++</span><span class="n">val</span><span class="p">,</span> <span class="o">++</span><span class="n">count</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// C^{tr}_{IA}*q^{I\to A}_{imp} term</span>
      <span class="n">QP_obj</span><span class="p">.</span><span class="n">c</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">Loc</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">CountryImport</span><span class="p">)</span> <span class="o">+</span> <span class="n">count</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">val</span><span class="p">);</span>
      <span class="c1">// \pi^I*q^{I\to A}_{imp} term</span>
      <span class="n">QP_obj</span><span class="p">.</span><span class="n">C</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">Loc</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">CountryImport</span><span class="p">)</span> <span class="o">+</span> <span class="n">count</span><span class="p">,</span>
                  <span class="k">this</span><span class="o">-&gt;</span><span class="n">getPosition</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">getNumLeaders</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                                    <span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">End</span><span class="p">)</span> <span class="o">-</span>
                      <span class="n">nThisCountryvars</span> <span class="o">+</span> <span class="n">val</span><span class="p">.</span><span class="n">row</span><span class="p">())</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="c1">// this-&gt;Locations.at(val.row()).at(Models::LeaderVars::End)) = 1;</span>
      <span class="c1">// this-&gt;getPosition(val.row(), Models::LeaderVars::End)) = 1;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">GRBModel</span><span class="o">&gt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">EPEC</span><span class="o">::</span><span class="n">Respond</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="n">name</span><span class="p">,</span>
                                           <span class="k">const</span> <span class="n">arma</span><span class="o">::</span><span class="n">vec</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">Game</span><span class="o">::</span><span class="n">EPEC</span><span class="o">::</span><span class="n">respond</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">name2nos</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">x</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Models</span><span class="o">::</span><span class="n">EPEC</span><span class="o">::</span><span class="n">updateLocations</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">getNumLeaders</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">LeadLocs</span> <span class="o">&amp;</span><span class="n">Loc</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">Locations</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
    <span class="n">Models</span><span class="o">::</span><span class="n">decreaseVal</span><span class="p">(</span><span class="n">Loc</span><span class="p">,</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">ConvHullDummy</span><span class="p">,</span>
                        <span class="n">Loc</span><span class="p">[</span><span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">ConvHullDummy</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span>
                            <span class="n">Loc</span><span class="p">[</span><span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">ConvHullDummy</span><span class="p">]);</span>
    <span class="n">Models</span><span class="o">::</span><span class="n">increaseVal</span><span class="p">(</span><span class="n">Loc</span><span class="p">,</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">ConvHullDummy</span><span class="p">,</span>
                        <span class="k">this</span><span class="o">-&gt;</span><span class="n">ConvexHullVariables</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Models</span><span class="o">::</span><span class="n">increaseVal</span><span class="p">(</span><span class="n">LeadLocs</span> <span class="o">&amp;</span><span class="n">L</span><span class="p">,</span> <span class="k">const</span> <span class="n">LeaderVars</span> <span class="n">start</span><span class="p">,</span>
                         <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">val</span><span class="p">,</span> <span class="k">const</span> <span class="kt">bool</span> <span class="n">startnext</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">LeaderVars</span> <span class="n">start_rl</span> <span class="o">=</span> <span class="p">(</span><span class="n">LeaderVars</span><span class="p">)(</span><span class="n">startnext</span> <span class="o">?</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">:</span> <span class="n">start</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">LeaderVars</span> <span class="n">l</span> <span class="o">=</span> <span class="n">start_rl</span><span class="p">;</span> <span class="n">l</span> <span class="o">!=</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">End</span><span class="p">;</span> <span class="n">l</span> <span class="o">=</span> <span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">L</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">+=</span> <span class="n">val</span><span class="p">;</span>
  <span class="n">L</span><span class="p">[</span><span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">End</span><span class="p">]</span> <span class="o">+=</span> <span class="n">val</span><span class="p">;</span>
  <span class="c1">// BOOST_LOG_TRIVIAL(error)&lt;&lt;&quot;End location changed to:</span>
  <span class="c1">// &quot;&lt;&lt;L[Models::LeaderVars::End];</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Models</span><span class="o">::</span><span class="n">decreaseVal</span><span class="p">(</span><span class="n">LeadLocs</span> <span class="o">&amp;</span><span class="n">L</span><span class="p">,</span> <span class="k">const</span> <span class="n">LeaderVars</span> <span class="n">start</span><span class="p">,</span>
                         <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">val</span><span class="p">,</span> <span class="k">const</span> <span class="kt">bool</span> <span class="n">startnext</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">LeaderVars</span> <span class="n">start_rl</span> <span class="o">=</span> <span class="p">(</span><span class="n">LeaderVars</span><span class="p">)(</span><span class="n">startnext</span> <span class="o">?</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">:</span> <span class="n">start</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">LeaderVars</span> <span class="n">l</span> <span class="o">=</span> <span class="n">start_rl</span><span class="p">;</span> <span class="n">l</span> <span class="o">!=</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">End</span><span class="p">;</span> <span class="n">l</span> <span class="o">=</span> <span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">L</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">-=</span> <span class="n">val</span><span class="p">;</span>
  <span class="n">L</span><span class="p">[</span><span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">End</span><span class="p">]</span> <span class="o">-=</span> <span class="n">val</span><span class="p">;</span>
  <span class="c1">// BOOST_LOG_TRIVIAL(error)&lt;&lt;&quot;End location changed to:</span>
  <span class="c1">// &quot;&lt;&lt;L[Models::LeaderVars::End];</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Models</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">LeadLocs</span> <span class="o">&amp;</span><span class="n">L</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">LeaderVars</span> <span class="n">l</span> <span class="o">=</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">FollowerStart</span><span class="p">;</span>
       <span class="n">l</span> <span class="o">!=</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">End</span><span class="p">;</span> <span class="n">l</span> <span class="o">=</span> <span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">L</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">L</span><span class="p">[</span><span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">End</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">Models</span><span class="o">::</span><span class="n">FollPar</span> <span class="k">operator</span><span class="o">+</span><span class="p">(</span><span class="k">const</span> <span class="n">Models</span><span class="o">::</span><span class="n">FollPar</span> <span class="o">&amp;</span><span class="n">F1</span><span class="p">,</span>
                          <span class="k">const</span> <span class="n">Models</span><span class="o">::</span><span class="n">FollPar</span> <span class="o">&amp;</span><span class="n">F2</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">cq</span><span class="p">,</span> <span class="n">cl</span><span class="p">,</span> <span class="n">cap</span><span class="p">,</span> <span class="n">ec</span><span class="p">,</span> <span class="n">tc</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">nm</span><span class="p">;</span>

  <span class="n">cq</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">cq</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">F1</span><span class="p">.</span><span class="n">costs_quad</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">F1</span><span class="p">.</span><span class="n">costs_quad</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
  <span class="n">cq</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">cq</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">F2</span><span class="p">.</span><span class="n">costs_quad</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">F2</span><span class="p">.</span><span class="n">costs_quad</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>

  <span class="n">cl</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">cl</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">F1</span><span class="p">.</span><span class="n">costs_lin</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">F1</span><span class="p">.</span><span class="n">costs_lin</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
  <span class="n">cl</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">cl</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">F2</span><span class="p">.</span><span class="n">costs_lin</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">F2</span><span class="p">.</span><span class="n">costs_lin</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>

  <span class="n">cap</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">cap</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">F1</span><span class="p">.</span><span class="n">capacities</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">F1</span><span class="p">.</span><span class="n">capacities</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
  <span class="n">cap</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">cap</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">F2</span><span class="p">.</span><span class="n">capacities</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">F2</span><span class="p">.</span><span class="n">capacities</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>

  <span class="n">ec</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">ec</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">F1</span><span class="p">.</span><span class="n">emission_costs</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">F1</span><span class="p">.</span><span class="n">emission_costs</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
  <span class="n">ec</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">ec</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">F2</span><span class="p">.</span><span class="n">emission_costs</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">F2</span><span class="p">.</span><span class="n">emission_costs</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>

  <span class="n">tc</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">tc</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">F1</span><span class="p">.</span><span class="n">tax_caps</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">F1</span><span class="p">.</span><span class="n">tax_caps</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
  <span class="n">tc</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">tc</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">F2</span><span class="p">.</span><span class="n">tax_caps</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">F2</span><span class="p">.</span><span class="n">tax_caps</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>

  <span class="n">nm</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">nm</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">F1</span><span class="p">.</span><span class="n">names</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">F1</span><span class="p">.</span><span class="n">names</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
  <span class="n">nm</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">nm</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">F2</span><span class="p">.</span><span class="n">names</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">F2</span><span class="p">.</span><span class="n">names</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>

  <span class="k">return</span> <span class="n">Models</span><span class="o">::</span><span class="n">FollPar</span><span class="p">(</span><span class="n">cq</span><span class="p">,</span> <span class="n">cl</span><span class="p">,</span> <span class="n">cap</span><span class="p">,</span> <span class="n">ec</span><span class="p">,</span> <span class="n">tc</span><span class="p">,</span> <span class="n">nm</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span> <span class="n">Models</span><span class="o">::</span><span class="k">operator</span><span class="o">+</span><span class="p">(</span><span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">LeaderVars</span><span class="o">&gt;</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">string</span> <span class="n">to_string</span><span class="p">(</span><span class="k">const</span> <span class="n">GRBConstr</span> <span class="o">&amp;</span><span class="n">cons</span><span class="p">,</span> <span class="k">const</span> <span class="n">GRBModel</span> <span class="o">&amp;</span><span class="n">model</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">const</span> <span class="n">GRBVar</span> <span class="o">*</span><span class="n">vars</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">getVars</span><span class="p">();</span>
  <span class="k">const</span> <span class="kt">int</span> <span class="n">nVars</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">GRB_IntAttr_NumVars</span><span class="p">);</span>
  <span class="n">ostringstream</span> <span class="n">oss</span><span class="p">;</span>
  <span class="n">oss</span> <span class="o">&lt;&lt;</span> <span class="n">cons</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">GRB_StringAttr_ConstrName</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;:</span><span class="se">\t\t</span><span class="s">&quot;</span><span class="p">;</span>
  <span class="k">constexpr</span> <span class="kt">double</span> <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-5</span><span class="p">;</span>
  <span class="c1">// LHS</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nVars</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">double</span> <span class="n">coeff</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">getCoeff</span><span class="p">(</span><span class="n">cons</span><span class="p">,</span> <span class="n">vars</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">coeff</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">eps</span><span class="p">)</span> <span class="p">{</span>
      <span class="kt">char</span> <span class="n">sign</span> <span class="o">=</span> <span class="p">(</span><span class="n">coeff</span> <span class="o">&gt;</span> <span class="n">eps</span><span class="p">)</span> <span class="o">?</span> <span class="sc">&#39;+&#39;</span> <span class="o">:</span> <span class="sc">&#39; &#39;</span><span class="p">;</span>
      <span class="n">oss</span> <span class="o">&lt;&lt;</span> <span class="n">sign</span> <span class="o">&lt;&lt;</span> <span class="n">coeff</span> <span class="o">&lt;&lt;</span> <span class="n">to_string</span><span class="p">(</span><span class="n">vars</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="c1">// Inequality/Equality and RHS</span>
  <span class="n">oss</span> <span class="o">&lt;&lt;</span> <span class="n">cons</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">GRB_CharAttr_Sense</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">cons</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">GRB_DoubleAttr_RHS</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">oss</span><span class="p">.</span><span class="n">str</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">string</span> <span class="n">to_string</span><span class="p">(</span><span class="k">const</span> <span class="n">GRBVar</span> <span class="o">&amp;</span><span class="n">var</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">string</span> <span class="n">name</span> <span class="o">=</span> <span class="n">var</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">GRB_StringAttr_VarName</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">name</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span> <span class="o">?</span> <span class="s">&quot;unNamedvar&quot;</span> <span class="o">:</span> <span class="n">name</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Models</span><span class="o">::</span><span class="n">EPEC</span><span class="o">::</span><span class="n">write</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="n">filename</span><span class="p">,</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="p">,</span>
                         <span class="kt">bool</span> <span class="n">append</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
  <span class="n">ofstream</span> <span class="n">file</span><span class="p">;</span>
  <span class="n">file</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">append</span> <span class="o">?</span> <span class="n">ios</span><span class="o">::</span><span class="nl">app</span> <span class="p">:</span> <span class="n">ios</span><span class="o">::</span><span class="n">out</span><span class="p">);</span>
  <span class="k">const</span> <span class="n">LeadAllPar</span> <span class="o">&amp;</span><span class="n">Params</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">AllLeadPars</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
  <span class="n">file</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;**************************************************</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
  <span class="n">file</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;COUNTRY: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Params</span><span class="p">.</span><span class="n">name</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
  <span class="n">file</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;- - - - - - - - - - - - - - - - - - - - - - - - - </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
  <span class="n">file</span> <span class="o">&lt;&lt;</span> <span class="n">Params</span><span class="p">;</span>
  <span class="n">file</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;**************************************************</span><span class="se">\n\n\n\n\n</span><span class="s">&quot;</span><span class="p">;</span>
  <span class="n">file</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Models</span><span class="o">::</span><span class="n">EPEC</span><span class="o">::</span><span class="n">write</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="n">filename</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">append</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">append</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">ofstream</span> <span class="n">file</span><span class="p">;</span>
    <span class="n">file</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">ios</span><span class="o">::</span><span class="n">app</span><span class="p">);</span>
    <span class="n">file</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n\n\n\n\n</span><span class="s">&quot;</span><span class="p">;</span>
    <span class="n">file</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;##################################################</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
    <span class="n">file</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;############### COUNTRY PARAMETERS ###############</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
    <span class="n">file</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;##################################################</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">getNumLeaders</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">write</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">append</span> <span class="o">||</span> <span class="n">i</span><span class="p">));</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Models</span><span class="o">::</span><span class="n">EPEC</span><span class="o">::</span><span class="n">writeSolutionJSON</span><span class="p">(</span><span class="n">string</span> <span class="n">filename</span><span class="p">,</span> <span class="k">const</span> <span class="n">arma</span><span class="o">::</span><span class="n">vec</span> <span class="n">x</span><span class="p">,</span>
                                     <span class="k">const</span> <span class="n">arma</span><span class="o">::</span><span class="n">vec</span> <span class="n">z</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
  <span class="n">StringBuffer</span> <span class="n">s</span><span class="p">;</span>
  <span class="n">PrettyWriter</span><span class="o">&lt;</span><span class="n">StringBuffer</span><span class="o">&gt;</span> <span class="n">writer</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
  <span class="n">writer</span><span class="p">.</span><span class="n">StartObject</span><span class="p">();</span>
  <span class="n">writer</span><span class="p">.</span><span class="n">Key</span><span class="p">(</span><span class="s">&quot;Meta&quot;</span><span class="p">);</span>
  <span class="n">writer</span><span class="p">.</span><span class="n">StartObject</span><span class="p">();</span>
  <span class="n">writer</span><span class="p">.</span><span class="n">Key</span><span class="p">(</span><span class="s">&quot;isPureEquilibrium&quot;</span><span class="p">);</span>
  <span class="n">writer</span><span class="p">.</span><span class="n">Bool</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">isPureStrategy</span><span class="p">());</span>
  <span class="n">writer</span><span class="p">.</span><span class="n">Key</span><span class="p">(</span><span class="s">&quot;nCountries&quot;</span><span class="p">);</span>
  <span class="n">writer</span><span class="p">.</span><span class="n">Uint</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">getNumLeaders</span><span class="p">());</span>
  <span class="n">writer</span><span class="p">.</span><span class="n">Key</span><span class="p">(</span><span class="s">&quot;nFollowers&quot;</span><span class="p">);</span>
  <span class="n">writer</span><span class="p">.</span><span class="n">StartArray</span><span class="p">();</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">getNumLeaders</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">Uint</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">AllLeadPars</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">n_followers</span><span class="p">);</span>
  <span class="n">writer</span><span class="p">.</span><span class="n">EndArray</span><span class="p">();</span>
  <span class="n">writer</span><span class="p">.</span><span class="n">Key</span><span class="p">(</span><span class="s">&quot;Countries&quot;</span><span class="p">);</span>
  <span class="n">writer</span><span class="p">.</span><span class="n">StartArray</span><span class="p">();</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">getNumLeaders</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">StartObject</span><span class="p">();</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">Key</span><span class="p">(</span><span class="s">&quot;FollowerStart&quot;</span><span class="p">);</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">Uint</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">getPosition</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">FollowerStart</span><span class="p">));</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">Key</span><span class="p">(</span><span class="s">&quot;NetImport&quot;</span><span class="p">);</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">Uint</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">getPosition</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">NetImport</span><span class="p">));</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">Key</span><span class="p">(</span><span class="s">&quot;NetExport&quot;</span><span class="p">);</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">Uint</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">getPosition</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">NetExport</span><span class="p">));</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">Key</span><span class="p">(</span><span class="s">&quot;CountryImport&quot;</span><span class="p">);</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">Uint</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">getPosition</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">CountryImport</span><span class="p">));</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">Key</span><span class="p">(</span><span class="s">&quot;Caps&quot;</span><span class="p">);</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">Uint</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">getPosition</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">Caps</span><span class="p">));</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">Key</span><span class="p">(</span><span class="s">&quot;Tax&quot;</span><span class="p">);</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">Uint</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">getPosition</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">Tax</span><span class="p">));</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">AllLeadPars</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">LeaderParam</span><span class="p">.</span><span class="n">tax_revenue</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">writer</span><span class="p">.</span><span class="n">Key</span><span class="p">(</span><span class="s">&quot;QuadraticTax&quot;</span><span class="p">);</span>
      <span class="n">writer</span><span class="p">.</span><span class="n">Uint</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">getPosition</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">TaxQuad</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">Key</span><span class="p">(</span><span class="s">&quot;DualVar&quot;</span><span class="p">);</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">Uint</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">getPosition</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">DualVar</span><span class="p">));</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">Key</span><span class="p">(</span><span class="s">&quot;ConvHullDummy&quot;</span><span class="p">);</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">Uint</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">getPosition</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">ConvHullDummy</span><span class="p">));</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">Key</span><span class="p">(</span><span class="s">&quot;End&quot;</span><span class="p">);</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">Uint</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">getPosition</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">End</span><span class="p">));</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">Key</span><span class="p">(</span><span class="s">&quot;ShadowPrice&quot;</span><span class="p">);</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">Uint</span><span class="p">(</span>
        <span class="k">this</span><span class="o">-&gt;</span><span class="n">getPosition</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">getNumLeaders</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">End</span><span class="p">)</span> <span class="o">+</span>
        <span class="n">i</span><span class="p">);</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">EndObject</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="n">writer</span><span class="p">.</span><span class="n">EndArray</span><span class="p">();</span>
  <span class="n">writer</span><span class="p">.</span><span class="n">EndObject</span><span class="p">();</span>
  <span class="n">writer</span><span class="p">.</span><span class="n">Key</span><span class="p">(</span><span class="s">&quot;Solution&quot;</span><span class="p">);</span>
  <span class="n">writer</span><span class="p">.</span><span class="n">StartObject</span><span class="p">();</span>
  <span class="n">writer</span><span class="p">.</span><span class="n">Key</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">);</span>
  <span class="n">writer</span><span class="p">.</span><span class="n">StartArray</span><span class="p">();</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">Double</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
  <span class="n">writer</span><span class="p">.</span><span class="n">EndArray</span><span class="p">();</span>
  <span class="n">writer</span><span class="p">.</span><span class="n">Key</span><span class="p">(</span><span class="s">&quot;z&quot;</span><span class="p">);</span>
  <span class="n">writer</span><span class="p">.</span><span class="n">StartArray</span><span class="p">();</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">z</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">Double</span><span class="p">(</span><span class="n">z</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
  <span class="n">writer</span><span class="p">.</span><span class="n">EndArray</span><span class="p">();</span>
  <span class="n">writer</span><span class="p">.</span><span class="n">EndObject</span><span class="p">();</span>
  <span class="n">writer</span><span class="p">.</span><span class="n">EndObject</span><span class="p">();</span>
  <span class="n">ofstream</span> <span class="nf">file</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s">&quot;.json&quot;</span><span class="p">);</span>
  <span class="n">file</span> <span class="o">&lt;&lt;</span> <span class="n">s</span><span class="p">.</span><span class="n">GetString</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Models</span><span class="o">::</span><span class="n">EPEC</span><span class="o">::</span><span class="n">readSolutionJSON</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="n">filename</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">ifstream</span> <span class="n">ifs</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s">&quot;.json&quot;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">ifs</span><span class="p">.</span><span class="n">good</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">IStreamWrapper</span> <span class="n">isw</span><span class="p">(</span><span class="n">ifs</span><span class="p">);</span>
    <span class="n">Document</span> <span class="n">d</span><span class="p">;</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="n">d</span><span class="p">.</span><span class="n">ParseStream</span><span class="p">(</span><span class="n">isw</span><span class="p">);</span>
      <span class="k">const</span> <span class="n">Value</span> <span class="o">&amp;</span><span class="n">x</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s">&quot;Solution&quot;</span><span class="p">].</span><span class="n">GetObject</span><span class="p">()[</span><span class="s">&quot;x&quot;</span><span class="p">];</span>
      <span class="c1">// const Value &amp;z = d[&quot;Solution&quot;].GetObject()[&quot;z&quot;];</span>
      <span class="n">arma</span><span class="o">::</span><span class="n">vec</span> <span class="n">new_x</span><span class="p">;</span>
      <span class="c1">// arma::vec new_z;</span>
      <span class="n">new_x</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">GetArray</span><span class="p">().</span><span class="n">Size</span><span class="p">());</span>
      <span class="c1">// new_z.zeros(z.GetArray().Size());</span>

      <span class="k">for</span> <span class="p">(</span><span class="n">SizeType</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">getNumVar</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">new_x</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">GetDouble</span><span class="p">();</span>

      <span class="c1">// for (SizeType i = 0; i &lt; this-&gt;getNumVar(); i++)</span>
      <span class="c1">// new_z.at(i) = z[i].GetDouble();</span>
      <span class="n">ifs</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
      <span class="k">this</span><span class="o">-&gt;</span><span class="n">warmstart</span><span class="p">(</span><span class="n">new_x</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">exception</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Exception in Models::readSolutionJSON : cannot read instance &quot;</span>
              <span class="s">&quot;file.&quot;</span>
           <span class="o">&lt;&lt;</span> <span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
      <span class="k">throw</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(...)</span> <span class="p">{</span>
      <span class="n">cerr</span>
          <span class="o">&lt;&lt;</span> <span class="s">&quot;Exception in Models::readSolutionJSON: cannot read instance file.&quot;</span>
          <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
      <span class="k">throw</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Exception in Models::readSolutionJSON : file instance not found.&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
    <span class="k">throw</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Models</span><span class="o">::</span><span class="n">EPEC</span><span class="o">::</span><span class="n">writeSolution</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="n">writeLevel</span><span class="p">,</span> <span class="n">string</span> <span class="n">filename</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Stats</span><span class="p">.</span><span class="n">Status</span> <span class="o">==</span> <span class="n">Game</span><span class="o">::</span><span class="n">EPECsolveStatus</span><span class="o">::</span><span class="n">NashEqFound</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">writeLevel</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">||</span> <span class="n">writeLevel</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="o">-&gt;</span><span class="n">WriteCountry</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">filename</span> <span class="o">+</span> <span class="s">&quot;.txt&quot;</span><span class="p">,</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">SolutionX</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ell</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">ell</span> <span class="o">&lt;</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">getNumLeaders</span><span class="p">();</span> <span class="o">++</span><span class="n">ell</span><span class="p">)</span>
        <span class="k">this</span><span class="o">-&gt;</span><span class="n">WriteCountry</span><span class="p">(</span><span class="n">ell</span><span class="p">,</span> <span class="n">filename</span> <span class="o">+</span> <span class="s">&quot;.txt&quot;</span><span class="p">,</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">SolutionX</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
      <span class="k">this</span><span class="o">-&gt;</span><span class="n">write</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s">&quot;.txt&quot;</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">writeLevel</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">||</span> <span class="n">writeLevel</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
      <span class="k">this</span><span class="o">-&gt;</span><span class="n">writeSolutionJSON</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">SolutionX</span><span class="p">,</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">SolutionZ</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Error in Models::EPEC::writeSolution: no solution to write.&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Models</span><span class="o">::</span><span class="n">EPECInstance</span><span class="o">::</span><span class="n">save</span><span class="p">(</span><span class="n">string</span> <span class="n">filename</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">StringBuffer</span> <span class="n">s</span><span class="p">;</span>
  <span class="n">PrettyWriter</span><span class="o">&lt;</span><span class="n">StringBuffer</span><span class="o">&gt;</span> <span class="n">writer</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
  <span class="n">writer</span><span class="p">.</span><span class="n">StartObject</span><span class="p">();</span>
  <span class="n">writer</span><span class="p">.</span><span class="n">Key</span><span class="p">(</span><span class="s">&quot;nCountries&quot;</span><span class="p">);</span>
  <span class="n">writer</span><span class="p">.</span><span class="n">Uint</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Countries</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
  <span class="n">writer</span><span class="p">.</span><span class="n">Key</span><span class="p">(</span><span class="s">&quot;Countries&quot;</span><span class="p">);</span>
  <span class="n">writer</span><span class="p">.</span><span class="n">StartArray</span><span class="p">();</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">Countries</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">StartObject</span><span class="p">();</span>

    <span class="n">writer</span><span class="p">.</span><span class="n">Key</span><span class="p">(</span><span class="s">&quot;nFollowers&quot;</span><span class="p">);</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">Uint</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Countries</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">n_followers</span><span class="p">);</span>

    <span class="n">writer</span><span class="p">.</span><span class="n">Key</span><span class="p">(</span><span class="s">&quot;Name&quot;</span><span class="p">);</span>
    <span class="n">string</span> <span class="n">currName</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">Countries</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">name</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">nameArray</span><span class="p">[</span><span class="n">currName</span><span class="p">.</span><span class="n">length</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
    <span class="n">strcpy</span><span class="p">(</span><span class="n">nameArray</span><span class="p">,</span> <span class="n">currName</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">String</span><span class="p">(</span><span class="n">nameArray</span><span class="p">);</span>

    <span class="n">writer</span><span class="p">.</span><span class="n">Key</span><span class="p">(</span><span class="s">&quot;DemandParam&quot;</span><span class="p">);</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">StartObject</span><span class="p">();</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">Key</span><span class="p">(</span><span class="s">&quot;Alpha&quot;</span><span class="p">);</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">Double</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Countries</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">DemandParam</span><span class="p">.</span><span class="n">alpha</span><span class="p">);</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">Key</span><span class="p">(</span><span class="s">&quot;Beta&quot;</span><span class="p">);</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">Double</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Countries</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">DemandParam</span><span class="p">.</span><span class="n">beta</span><span class="p">);</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">EndObject</span><span class="p">();</span>

    <span class="n">writer</span><span class="p">.</span><span class="n">Key</span><span class="p">(</span><span class="s">&quot;TransportationCosts&quot;</span><span class="p">);</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">StartArray</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">Countries</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
      <span class="n">writer</span><span class="p">.</span><span class="n">Double</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">TransportationCosts</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">));</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">EndArray</span><span class="p">();</span>

    <span class="n">writer</span><span class="p">.</span><span class="n">Key</span><span class="p">(</span><span class="s">&quot;LeaderParam&quot;</span><span class="p">);</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">StartObject</span><span class="p">();</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">Key</span><span class="p">(</span><span class="s">&quot;ImportLimit&quot;</span><span class="p">);</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">Double</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Countries</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">LeaderParam</span><span class="p">.</span><span class="n">import_limit</span><span class="p">);</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">Key</span><span class="p">(</span><span class="s">&quot;ExportLimit&quot;</span><span class="p">);</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">Double</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Countries</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">LeaderParam</span><span class="p">.</span><span class="n">export_limit</span><span class="p">);</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">Key</span><span class="p">(</span><span class="s">&quot;PriceLimit&quot;</span><span class="p">);</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">Double</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Countries</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">LeaderParam</span><span class="p">.</span><span class="n">price_limit</span><span class="p">);</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">Key</span><span class="p">(</span><span class="s">&quot;TaxRevenue&quot;</span><span class="p">);</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">Bool</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Countries</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">LeaderParam</span><span class="p">.</span><span class="n">tax_revenue</span><span class="p">);</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">Key</span><span class="p">(</span><span class="s">&quot;TaxationType&quot;</span><span class="p">);</span>
    <span class="k">switch</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Countries</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">LeaderParam</span><span class="p">.</span><span class="n">tax_type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">Models</span><span class="o">::</span><span class="n">TaxType</span><span class="o">::</span><span class="nl">StandardTax</span><span class="p">:</span>
      <span class="n">writer</span><span class="p">.</span><span class="n">Int</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="n">Models</span><span class="o">::</span><span class="n">TaxType</span><span class="o">::</span><span class="nl">SingleTax</span><span class="p">:</span>
      <span class="n">writer</span><span class="p">.</span><span class="n">Int</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">default</span><span class="o">:</span>
      <span class="n">writer</span><span class="p">.</span><span class="n">Int</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">EndObject</span><span class="p">();</span>

    <span class="n">writer</span><span class="p">.</span><span class="n">Key</span><span class="p">(</span><span class="s">&quot;Followers&quot;</span><span class="p">);</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">StartObject</span><span class="p">();</span>

    <span class="n">writer</span><span class="p">.</span><span class="n">Key</span><span class="p">(</span><span class="s">&quot;Names&quot;</span><span class="p">);</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">StartArray</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">Countries</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">n_followers</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">currName</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">Countries</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">FollowerParam</span><span class="p">.</span><span class="n">names</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">j</span><span class="p">);</span>
      <span class="kt">char</span> <span class="n">nameArrayCurrent</span><span class="p">[</span><span class="n">currName</span><span class="p">.</span><span class="n">length</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
      <span class="n">strcpy</span><span class="p">(</span><span class="n">nameArrayCurrent</span><span class="p">,</span> <span class="n">currName</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
      <span class="n">writer</span><span class="p">.</span><span class="n">String</span><span class="p">(</span><span class="n">nameArrayCurrent</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">EndArray</span><span class="p">();</span>

    <span class="n">writer</span><span class="p">.</span><span class="n">Key</span><span class="p">(</span><span class="s">&quot;Capacities&quot;</span><span class="p">);</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">StartArray</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">Countries</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">n_followers</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
      <span class="n">writer</span><span class="p">.</span><span class="n">Double</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Countries</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">FollowerParam</span><span class="p">.</span><span class="n">capacities</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">j</span><span class="p">));</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">EndArray</span><span class="p">();</span>

    <span class="n">writer</span><span class="p">.</span><span class="n">Key</span><span class="p">(</span><span class="s">&quot;LinearCosts&quot;</span><span class="p">);</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">StartArray</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">Countries</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">n_followers</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
      <span class="n">writer</span><span class="p">.</span><span class="n">Double</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Countries</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">FollowerParam</span><span class="p">.</span><span class="n">costs_lin</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">j</span><span class="p">));</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">EndArray</span><span class="p">();</span>

    <span class="n">writer</span><span class="p">.</span><span class="n">Key</span><span class="p">(</span><span class="s">&quot;QuadraticCosts&quot;</span><span class="p">);</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">StartArray</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">Countries</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">n_followers</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
      <span class="n">writer</span><span class="p">.</span><span class="n">Double</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Countries</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">FollowerParam</span><span class="p">.</span><span class="n">costs_quad</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">j</span><span class="p">));</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">EndArray</span><span class="p">();</span>

    <span class="n">writer</span><span class="p">.</span><span class="n">Key</span><span class="p">(</span><span class="s">&quot;EmissionCosts&quot;</span><span class="p">);</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">StartArray</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">Countries</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">n_followers</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
      <span class="n">writer</span><span class="p">.</span><span class="n">Double</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Countries</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">FollowerParam</span><span class="p">.</span><span class="n">emission_costs</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">j</span><span class="p">));</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">EndArray</span><span class="p">();</span>

    <span class="n">writer</span><span class="p">.</span><span class="n">Key</span><span class="p">(</span><span class="s">&quot;TaxCaps&quot;</span><span class="p">);</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">StartArray</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">Countries</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">n_followers</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
      <span class="n">writer</span><span class="p">.</span><span class="n">Double</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Countries</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">FollowerParam</span><span class="p">.</span><span class="n">tax_caps</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">j</span><span class="p">));</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">EndArray</span><span class="p">();</span>

    <span class="n">writer</span><span class="p">.</span><span class="n">EndObject</span><span class="p">();</span>

    <span class="n">writer</span><span class="p">.</span><span class="n">EndObject</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="n">writer</span><span class="p">.</span><span class="n">EndArray</span><span class="p">();</span>
  <span class="n">writer</span><span class="p">.</span><span class="n">EndObject</span><span class="p">();</span>
  <span class="n">ofstream</span> <span class="nf">file</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s">&quot;.json&quot;</span><span class="p">);</span>
  <span class="n">file</span> <span class="o">&lt;&lt;</span> <span class="n">s</span><span class="p">.</span><span class="n">GetString</span><span class="p">();</span>
  <span class="n">file</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Models</span><span class="o">::</span><span class="n">EPECInstance</span><span class="o">::</span><span class="n">load</span><span class="p">(</span><span class="n">string</span> <span class="n">filename</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">ifstream</span> <span class="n">ifs</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s">&quot;.json&quot;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">ifs</span><span class="p">.</span><span class="n">good</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">IStreamWrapper</span> <span class="n">isw</span><span class="p">(</span><span class="n">ifs</span><span class="p">);</span>
    <span class="n">Document</span> <span class="n">d</span><span class="p">;</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="n">d</span><span class="p">.</span><span class="n">ParseStream</span><span class="p">(</span><span class="n">isw</span><span class="p">);</span>
      <span class="n">vector</span><span class="o">&lt;</span><span class="n">Models</span><span class="o">::</span><span class="n">LeadAllPar</span><span class="o">&gt;</span> <span class="n">LAP</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="kt">int</span> <span class="n">nCountries</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s">&quot;nCountries&quot;</span><span class="p">].</span><span class="n">GetInt</span><span class="p">();</span>
      <span class="n">arma</span><span class="o">::</span><span class="n">sp_mat</span> <span class="n">TrCo</span><span class="p">;</span>
      <span class="n">TrCo</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nCountries</span><span class="p">,</span> <span class="n">nCountries</span><span class="p">);</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">nCountries</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">const</span> <span class="n">Value</span> <span class="o">&amp;</span><span class="n">c</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s">&quot;Countries&quot;</span><span class="p">].</span><span class="n">GetArray</span><span class="p">()[</span><span class="n">j</span><span class="p">].</span><span class="n">GetObject</span><span class="p">();</span>

        <span class="n">Models</span><span class="o">::</span><span class="n">FollPar</span> <span class="n">FP</span><span class="p">;</span>
        <span class="k">const</span> <span class="n">Value</span> <span class="o">&amp;</span><span class="n">cap</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="s">&quot;Followers&quot;</span><span class="p">][</span><span class="s">&quot;Capacities&quot;</span><span class="p">];</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">SizeType</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">cap</span><span class="p">.</span><span class="n">GetArray</span><span class="p">().</span><span class="n">Size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">FP</span><span class="p">.</span><span class="n">capacities</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">cap</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">GetDouble</span><span class="p">());</span>
        <span class="p">}</span>
        <span class="k">const</span> <span class="n">Value</span> <span class="o">&amp;</span><span class="n">lc</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="s">&quot;Followers&quot;</span><span class="p">][</span><span class="s">&quot;LinearCosts&quot;</span><span class="p">];</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">SizeType</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">lc</span><span class="p">.</span><span class="n">GetArray</span><span class="p">().</span><span class="n">Size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">FP</span><span class="p">.</span><span class="n">costs_lin</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">lc</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">GetDouble</span><span class="p">());</span>
        <span class="p">}</span>
        <span class="k">const</span> <span class="n">Value</span> <span class="o">&amp;</span><span class="n">qc</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="s">&quot;Followers&quot;</span><span class="p">][</span><span class="s">&quot;QuadraticCosts&quot;</span><span class="p">];</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">SizeType</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">qc</span><span class="p">.</span><span class="n">GetArray</span><span class="p">().</span><span class="n">Size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">FP</span><span class="p">.</span><span class="n">costs_quad</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">qc</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">GetDouble</span><span class="p">());</span>
        <span class="p">}</span>
        <span class="k">const</span> <span class="n">Value</span> <span class="o">&amp;</span><span class="n">ec</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="s">&quot;Followers&quot;</span><span class="p">][</span><span class="s">&quot;EmissionCosts&quot;</span><span class="p">];</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">SizeType</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ec</span><span class="p">.</span><span class="n">GetArray</span><span class="p">().</span><span class="n">Size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">FP</span><span class="p">.</span><span class="n">emission_costs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">ec</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">GetDouble</span><span class="p">());</span>
        <span class="p">}</span>
        <span class="k">const</span> <span class="n">Value</span> <span class="o">&amp;</span><span class="n">tc</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="s">&quot;Followers&quot;</span><span class="p">][</span><span class="s">&quot;TaxCaps&quot;</span><span class="p">];</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">SizeType</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">tc</span><span class="p">.</span><span class="n">GetArray</span><span class="p">().</span><span class="n">Size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">FP</span><span class="p">.</span><span class="n">tax_caps</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">tc</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">GetDouble</span><span class="p">());</span>
        <span class="p">}</span>
        <span class="k">const</span> <span class="n">Value</span> <span class="o">&amp;</span><span class="n">nm</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="s">&quot;Followers&quot;</span><span class="p">][</span><span class="s">&quot;Names&quot;</span><span class="p">];</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">SizeType</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nm</span><span class="p">.</span><span class="n">GetArray</span><span class="p">().</span><span class="n">Size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">FP</span><span class="p">.</span><span class="n">names</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">nm</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">GetString</span><span class="p">());</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">SizeType</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">c</span><span class="p">[</span><span class="s">&quot;TransportationCosts&quot;</span><span class="p">].</span><span class="n">GetArray</span><span class="p">().</span><span class="n">Size</span><span class="p">();</span>
             <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">TrCo</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="s">&quot;TransportationCosts&quot;</span><span class="p">].</span><span class="n">GetArray</span><span class="p">()[</span><span class="n">i</span><span class="p">].</span><span class="n">GetDouble</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="kt">bool</span> <span class="n">tax_revenue</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s">&quot;LeaderParam&quot;</span><span class="p">].</span><span class="n">HasMember</span><span class="p">(</span><span class="s">&quot;TaxRevenue&quot;</span><span class="p">))</span> <span class="p">{</span>
          <span class="n">tax_revenue</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="s">&quot;LeaderParam&quot;</span><span class="p">].</span><span class="n">GetObject</span><span class="p">()[</span><span class="s">&quot;TaxRevenue&quot;</span><span class="p">].</span><span class="n">GetBool</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tax_type</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s">&quot;LeaderParam&quot;</span><span class="p">].</span><span class="n">HasMember</span><span class="p">(</span><span class="s">&quot;TaxationType&quot;</span><span class="p">))</span> <span class="p">{</span>
          <span class="n">tax_type</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="s">&quot;LeaderParam&quot;</span><span class="p">].</span><span class="n">GetObject</span><span class="p">()[</span><span class="s">&quot;TaxationType&quot;</span><span class="p">].</span><span class="n">GetInt</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="n">LAP</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Models</span><span class="o">::</span><span class="n">LeadAllPar</span><span class="p">(</span>
            <span class="n">FP</span><span class="p">.</span><span class="n">capacities</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">c</span><span class="p">[</span><span class="s">&quot;Name&quot;</span><span class="p">].</span><span class="n">GetString</span><span class="p">(),</span> <span class="n">FP</span><span class="p">,</span>
            <span class="p">{</span><span class="n">c</span><span class="p">[</span><span class="s">&quot;DemandParam&quot;</span><span class="p">].</span><span class="n">GetObject</span><span class="p">()[</span><span class="s">&quot;Alpha&quot;</span><span class="p">].</span><span class="n">GetDouble</span><span class="p">(),</span>
             <span class="n">c</span><span class="p">[</span><span class="s">&quot;DemandParam&quot;</span><span class="p">].</span><span class="n">GetObject</span><span class="p">()[</span><span class="s">&quot;Beta&quot;</span><span class="p">].</span><span class="n">GetDouble</span><span class="p">()},</span>
            <span class="p">{</span><span class="n">c</span><span class="p">[</span><span class="s">&quot;LeaderParam&quot;</span><span class="p">].</span><span class="n">GetObject</span><span class="p">()[</span><span class="s">&quot;ImportLimit&quot;</span><span class="p">].</span><span class="n">GetDouble</span><span class="p">(),</span>
             <span class="n">c</span><span class="p">[</span><span class="s">&quot;LeaderParam&quot;</span><span class="p">].</span><span class="n">GetObject</span><span class="p">()[</span><span class="s">&quot;ExportLimit&quot;</span><span class="p">].</span><span class="n">GetDouble</span><span class="p">(),</span>
             <span class="n">c</span><span class="p">[</span><span class="s">&quot;LeaderParam&quot;</span><span class="p">].</span><span class="n">GetObject</span><span class="p">()[</span><span class="s">&quot;PriceLimit&quot;</span><span class="p">].</span><span class="n">GetDouble</span><span class="p">(),</span>
             <span class="n">tax_revenue</span><span class="p">,</span> <span class="n">tax_type</span><span class="p">}));</span>
      <span class="p">}</span>
      <span class="n">ifs</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
      <span class="k">this</span><span class="o">-&gt;</span><span class="n">Countries</span> <span class="o">=</span> <span class="n">LAP</span><span class="p">;</span>
      <span class="k">this</span><span class="o">-&gt;</span><span class="n">TransportationCosts</span> <span class="o">=</span> <span class="n">TrCo</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">exception</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Exception in Models::load : cannot read instance file.&quot;</span>
           <span class="o">&lt;&lt;</span> <span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
      <span class="k">throw</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(...)</span> <span class="p">{</span>
      <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Exception in Models::load : cannot read instance file.&quot;</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
      <span class="k">throw</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Exception in Models::load : file instance not found.&quot;</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
    <span class="k">throw</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Models</span><span class="o">::</span><span class="n">EPEC</span><span class="o">::</span><span class="n">WriteCountry</span><span class="p">(</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="k">const</span> <span class="n">string</span> <span class="n">filename</span><span class="p">,</span>
                                <span class="k">const</span> <span class="n">arma</span><span class="o">::</span><span class="n">vec</span> <span class="n">x</span><span class="p">,</span> <span class="k">const</span> <span class="kt">bool</span> <span class="n">append</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
  <span class="c1">// if (!TheLCP) return;</span>
  <span class="c1">// const LeadLocs&amp; Loc = this-&gt;Locations.at(i);</span>

  <span class="n">ofstream</span> <span class="n">file</span><span class="p">;</span>
  <span class="n">file</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">append</span> <span class="o">?</span> <span class="n">ios</span><span class="o">::</span><span class="nl">app</span> <span class="p">:</span> <span class="n">ios</span><span class="o">::</span><span class="n">out</span><span class="p">);</span>
  <span class="c1">// FILE OPERATIONS START</span>
  <span class="k">const</span> <span class="n">LeadAllPar</span> <span class="o">&amp;</span><span class="n">Params</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">AllLeadPars</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
  <span class="n">file</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;**************************************************</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
  <span class="n">file</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;COUNTRY: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Params</span><span class="p">.</span><span class="n">name</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
  <span class="n">file</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;**************************************************</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">;</span>
  <span class="c1">// Country Variables</span>
  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">foll_prod</span><span class="p">;</span>
  <span class="n">foll_prod</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">getPosition</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">FollowerStart</span><span class="p">);</span>
  <span class="c1">// Domestic production</span>
  <span class="kt">double</span> <span class="n">prod</span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">Params</span><span class="p">.</span><span class="n">n_followers</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
    <span class="n">prod</span> <span class="o">+=</span> <span class="n">x</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">foll_prod</span> <span class="o">+</span> <span class="n">j</span><span class="p">);</span>
  <span class="c1">// Trade</span>
  <span class="kt">double</span> <span class="n">Export</span><span class="p">{</span><span class="n">x</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">getPosition</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">NetExport</span><span class="p">))};</span>
  <span class="kt">double</span> <span class="n">exportPrice</span><span class="p">{</span><span class="n">x</span><span class="p">.</span><span class="n">at</span><span class="p">(</span>
      <span class="k">this</span><span class="o">-&gt;</span><span class="n">getPosition</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">getNumLeaders</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">End</span><span class="p">)</span> <span class="o">+</span>
      <span class="n">i</span><span class="p">)};</span>
  <span class="kt">double</span> <span class="k">import</span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">getPosition</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">CountryImport</span><span class="p">);</span>
       <span class="n">j</span> <span class="o">&lt;</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">getPosition</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">CountryImport</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
    <span class="k">import</span> <span class="o">+=</span> <span class="n">x</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">j</span><span class="p">);</span>
  <span class="c1">// Writing national level details</span>
  <span class="n">file</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;PureStrategy:&quot;</span> <span class="o">&lt;&lt;</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">isPureStrategy</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
  <span class="n">file</span> <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">label</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Domestic production&quot;</span>
       <span class="o">&lt;&lt;</span> <span class="s">&quot;:&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="n">prod</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">Export</span> <span class="o">&gt;=</span> <span class="k">import</span><span class="p">)</span>
    <span class="n">file</span> <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">label</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Net exports&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot;:&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="n">Export</span> <span class="o">-</span> <span class="k">import</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
  <span class="k">else</span>
    <span class="n">file</span> <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">label</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Net imports&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot;:&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="k">import</span> <span class="o">-</span> <span class="n">Export</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
  <span class="n">file</span> <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">label</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Export price&quot;</span>
       <span class="o">&lt;&lt;</span> <span class="s">&quot;:&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="n">exportPrice</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
  <span class="n">file</span> <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">label</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; -&gt; Total Export&quot;</span>
       <span class="o">&lt;&lt;</span> <span class="s">&quot;:&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="n">Export</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
  <span class="n">file</span> <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">label</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; -&gt; Total Import&quot;</span>
       <span class="o">&lt;&lt;</span> <span class="s">&quot;:&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="k">import</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
  <span class="n">file</span> <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">label</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Domestic consumed quantity&quot;</span>
       <span class="o">&lt;&lt;</span> <span class="s">&quot;:&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="k">import</span> <span class="o">-</span> <span class="n">Export</span> <span class="o">+</span> <span class="n">prod</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
  <span class="n">file</span> <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">label</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Domestic price&quot;</span>
       <span class="o">&lt;&lt;</span> <span class="s">&quot;:&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">val</span>
       <span class="o">&lt;&lt;</span> <span class="n">Params</span><span class="p">.</span><span class="n">DemandParam</span><span class="p">.</span><span class="n">alpha</span> <span class="o">-</span>
              <span class="n">Params</span><span class="p">.</span><span class="n">DemandParam</span><span class="p">.</span><span class="n">beta</span> <span class="o">*</span> <span class="p">(</span><span class="k">import</span> <span class="o">-</span> <span class="n">Export</span> <span class="o">+</span> <span class="n">prod</span><span class="p">)</span>
       <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>

  <span class="n">file</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>

  <span class="c1">// Follower productions</span>
  <span class="n">file</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;- - - - - - - - - - - - - - - - - - - - - - - - - </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
  <span class="n">file</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;FOLLOWER DETAILS:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">Params</span><span class="p">.</span><span class="n">n_followers</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">WriteFollower</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>

  <span class="n">file</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n\n\n</span><span class="s">&quot;</span><span class="p">;</span>
  <span class="c1">// FILE OPERATIONS END</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Models</span><span class="o">::</span><span class="n">EPEC</span><span class="o">::</span><span class="n">WriteFollower</span><span class="p">(</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">j</span><span class="p">,</span>
                                 <span class="k">const</span> <span class="n">string</span> <span class="n">filename</span><span class="p">,</span>
                                 <span class="k">const</span> <span class="n">arma</span><span class="o">::</span><span class="n">vec</span> <span class="n">x</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
  <span class="n">ofstream</span> <span class="n">file</span><span class="p">;</span>
  <span class="n">file</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">ios</span><span class="o">::</span><span class="n">app</span><span class="p">);</span>

  <span class="c1">// Country Variables</span>
  <span class="k">const</span> <span class="n">LeadAllPar</span> <span class="o">&amp;</span><span class="n">Params</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">AllLeadPars</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">foll_prod</span><span class="p">,</span> <span class="n">foll_tax</span><span class="p">,</span> <span class="n">foll_lim</span><span class="p">,</span> <span class="n">foll_taxQ</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">foll_prod</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">getPosition</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">FollowerStart</span><span class="p">);</span>
  <span class="n">foll_tax</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">getPosition</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">Tax</span><span class="p">);</span>
  <span class="n">foll_lim</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">getPosition</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">Caps</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">Params</span><span class="p">.</span><span class="n">LeaderParam</span><span class="p">.</span><span class="n">tax_revenue</span><span class="p">)</span>
    <span class="n">foll_taxQ</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">getPosition</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Models</span><span class="o">::</span><span class="n">LeaderVars</span><span class="o">::</span><span class="n">TaxQuad</span><span class="p">);</span>

  <span class="n">string</span> <span class="n">name</span><span class="p">;</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Params</span><span class="p">.</span><span class="n">name</span> <span class="o">+</span> <span class="s">&quot; --- &quot;</span> <span class="o">+</span> <span class="n">Params</span><span class="p">.</span><span class="n">FollowerParam</span><span class="p">.</span><span class="n">names</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">j</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(...)</span> <span class="p">{</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Follower &quot;</span> <span class="o">+</span> <span class="n">to_string</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; of leader &quot;</span> <span class="o">+</span> <span class="n">to_string</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">file</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
       <span class="o">&lt;&lt;</span> <span class="n">name</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">;</span> <span class="c1">//&lt;&lt;&quot; named &quot;&lt;&lt;Params.FollowerParam.names.at(j)&lt;&lt;&quot;\n&quot;;</span>
  <span class="kt">double</span> <span class="n">tax</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">Params</span><span class="p">.</span><span class="n">LeaderParam</span><span class="p">.</span><span class="n">tax_type</span> <span class="o">==</span> <span class="n">Models</span><span class="o">::</span><span class="n">TaxType</span><span class="o">::</span><span class="n">StandardTax</span><span class="p">)</span>
    <span class="n">tax</span> <span class="o">=</span> <span class="n">x</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">foll_tax</span> <span class="o">+</span> <span class="n">j</span><span class="p">);</span>
  <span class="k">else</span>
    <span class="n">tax</span> <span class="o">=</span> <span class="n">x</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">foll_tax</span><span class="p">);</span>
  <span class="k">const</span> <span class="kt">double</span> <span class="n">q</span> <span class="o">=</span> <span class="n">x</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">foll_prod</span> <span class="o">+</span> <span class="n">j</span><span class="p">);</span>
  <span class="kt">double</span> <span class="n">taxQ</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">Params</span><span class="p">.</span><span class="n">LeaderParam</span><span class="p">.</span><span class="n">tax_revenue</span><span class="p">)</span>
    <span class="n">taxQ</span> <span class="o">=</span> <span class="n">q</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">x</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">foll_taxQ</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">/</span> <span class="nl">q</span> <span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">foll_taxQ</span> <span class="o">+</span> <span class="n">j</span><span class="p">);</span>
  <span class="k">const</span> <span class="kt">double</span> <span class="n">lim</span> <span class="o">=</span> <span class="n">x</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">foll_lim</span> <span class="o">+</span> <span class="n">j</span><span class="p">);</span>
  <span class="k">const</span> <span class="kt">double</span> <span class="n">lin</span> <span class="o">=</span> <span class="n">Params</span><span class="p">.</span><span class="n">FollowerParam</span><span class="p">.</span><span class="n">costs_lin</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">j</span><span class="p">);</span>
  <span class="k">const</span> <span class="kt">double</span> <span class="n">quad</span> <span class="o">=</span> <span class="n">Params</span><span class="p">.</span><span class="n">FollowerParam</span><span class="p">.</span><span class="n">costs_quad</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">j</span><span class="p">);</span>

  <span class="n">file</span> <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">label</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Quantity produced&quot;</span>
       <span class="o">&lt;&lt;</span> <span class="s">&quot;:&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="n">q</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
  <span class="c1">// file &lt;&lt; &quot;x(): &quot; &lt;&lt; foll_prod + j &lt;&lt; &#39;\n&#39;;</span>
  <span class="n">file</span> <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">label</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Capacity of production&quot;</span>
       <span class="o">&lt;&lt;</span> <span class="s">&quot;:&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="n">Params</span><span class="p">.</span><span class="n">FollowerParam</span><span class="p">.</span><span class="n">capacities</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
       <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
  <span class="n">file</span> <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">label</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Limit on production&quot;</span>
       <span class="o">&lt;&lt;</span> <span class="s">&quot;:&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="n">lim</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
  <span class="c1">// file &lt;&lt; &quot;x(): &quot; &lt;&lt; foll_lim + j &lt;&lt; &#39;\n&#39;;</span>
  <span class="n">file</span> <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">label</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Tax imposed&quot;</span>
       <span class="o">&lt;&lt;</span> <span class="s">&quot;:&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="n">tax</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">Params</span><span class="p">.</span><span class="n">LeaderParam</span><span class="p">.</span><span class="n">tax_type</span> <span class="o">==</span> <span class="n">Models</span><span class="o">::</span><span class="n">TaxType</span><span class="o">::</span><span class="n">CarbonTax</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">tax</span> <span class="o">=</span> <span class="n">tax</span> <span class="o">*</span> <span class="n">Params</span><span class="p">.</span><span class="n">FollowerParam</span><span class="p">.</span><span class="n">emission_costs</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">j</span><span class="p">);</span>
    <span class="n">file</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; per unit emission; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">tax</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; per unit energy&quot;</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">file</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">Params</span><span class="p">.</span><span class="n">LeaderParam</span><span class="p">.</span><span class="n">tax_revenue</span><span class="p">)</span>
    <span class="n">file</span> <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">label</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Tax imposed (Q)&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot;:&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="n">taxQ</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
  <span class="c1">// file &lt;&lt; Models::prn::label &lt;&lt; &quot;Tax cap&quot; &lt;&lt; &quot;:&quot; &lt;&lt;</span>
  <span class="c1">// Params.FollowerParam.tax_caps.at(j) &lt;&lt; tax &lt;&lt; &quot;\n&quot;;</span>
  <span class="c1">// file &lt;&lt; &quot;x(): &quot; &lt;&lt; foll_tax + j &lt;&lt; &#39;\n&#39;;</span>
  <span class="n">file</span> <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">label</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;  -Production cost function&quot;</span>
       <span class="o">&lt;&lt;</span> <span class="s">&quot;:&quot;</span>
       <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s"> C(q) = (&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">lin</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; + &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">tax</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;)*q + 0.5*&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">quad</span>
       <span class="o">&lt;&lt;</span> <span class="s">&quot;*q^2</span><span class="se">\n</span><span class="s">&quot;</span>
       <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">label</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span>
       <span class="o">&lt;&lt;</span> <span class="s">&quot;=&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">lin</span> <span class="o">+</span> <span class="n">tax</span><span class="p">)</span> <span class="o">*</span> <span class="n">q</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">quad</span> <span class="o">*</span> <span class="n">q</span> <span class="o">*</span> <span class="n">q</span>
       <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
  <span class="n">file</span> <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">label</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;  -Marginal cost of production&quot;</span>
       <span class="o">&lt;&lt;</span> <span class="s">&quot;:&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="n">quad</span> <span class="o">*</span> <span class="n">q</span> <span class="o">+</span> <span class="n">lin</span> <span class="o">+</span> <span class="n">tax</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
  <span class="n">file</span> <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">label</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Emission cost&quot;</span>
       <span class="o">&lt;&lt;</span> <span class="s">&quot;:&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Models</span><span class="o">::</span><span class="n">prn</span><span class="o">::</span><span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="n">Params</span><span class="p">.</span><span class="n">FollowerParam</span><span class="p">.</span><span class="n">emission_costs</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
       <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>

  <span class="n">file</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Models</span><span class="o">::</span><span class="n">EPEC</span><span class="o">::</span><span class="n">testLCP</span><span class="p">(</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">auto</span> <span class="n">country</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">get_LowerLevelNash</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
  <span class="n">Game</span><span class="o">::</span><span class="n">LCP</span> <span class="n">CountryLCP</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Env</span><span class="p">,</span> <span class="o">*</span><span class="n">country</span><span class="p">);</span>
  <span class="n">CountryLCP</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;dat/LCP_&quot;</span> <span class="o">+</span> <span class="n">to_string</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
  <span class="k">auto</span> <span class="n">model</span> <span class="o">=</span> <span class="n">CountryLCP</span><span class="p">.</span><span class="n">LCPasMIP</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
  <span class="n">model</span><span class="o">-&gt;</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;dat/CountryLCP_&quot;</span> <span class="o">+</span> <span class="n">to_string</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;.lp&quot;</span><span class="p">);</span>
  <span class="n">model</span><span class="o">-&gt;</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;dat/CountryLCP_&quot;</span> <span class="o">+</span> <span class="n">to_string</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;.sol&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, GD and SS

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>